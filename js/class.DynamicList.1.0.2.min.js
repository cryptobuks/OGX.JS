if(typeof OGX==="undefined"){var OGX=function(){}}OGX.prototype.DynamicList=function(e){"use strict";var t=this;var i=e;var l={container:null,list_container:null,enabled:true,selectable:true,key:null,mode:"single",filter:{enabled:false,field:null,prop:null,val:null,list:[]},bind:{pager:null,tag:null},bind_trigger:false,limit:10,pages:0,components:false,list:[],selected:[],css:null};this.el=null;this.enable=function(){i.enabled=true};this.disable=function(){i.enabled=false};this.setPage=function(e){i.start=i.limit*e;t.renderList()};this.setLimit=function(e){i.limit=e;t.renderList()};this.getItemPage=function(e,t){var l;if(!i.limit){return 0}var n=i.list;if(i.filter.enabled&&i.filter.val){n=i.filter.list}for(var r=0;r<n.length;r++){if(n[r][e]===t){l=Math.floor(r/i.limit);return l}}};this.setCSS=function(e){if(i.css){$(i.container).find(".ogx_dynamic_list_item").removeClass(i.css)}i.css=e;$(i.container).find(".ogx_dynamic_list_item").addClass(e)};this.setTemplate=function(e){i.template=e};this.getList=function(){if(i.list){return i.list}return[]};this.setList=function(e){i.start=0;i.list=e;i.selected=[];if(i.filter.enabled&&i.filter.val){i.filter.list=f(i.filter.prop);c(i.filter.list)}else{c(i.list)}if(i.bind.pager){if(i.list.length===0){i.bind.pager.setPages(1)}i.bind.pager.setPage(0)}};this.clearList=function(){$(i.list_container).empty()};this.bind=function(e,t){if(e.type){switch(e.type){case"RcpDynamicPager":if(i.limit){i.bind.pager=e;i.bind.pager.setPages(i.pages);s(true)}break;case"RcpTagManager":i.bind.tag=e;i.filter.enabled=true;i.filter.prop=t[0];a(true);break}}};this.unbind=function(e){switch(e.type){case"RcpDynamicPager":i.pager=null;break;case"RcpTagManager":i.tag=null;break}};this.setFilter=function(e,l){if(!i.filter){i.filter={}}i.filter.field=e;i.filter.prop=l;t.enableFilter()};this.unsetFilter=function(){delete i.filter};this.disableFilter=function(){$(i.filter.field).off("input");$(i.filter.field).off("focusout");i.filter.enabled=false};this.enableFilter=function(){i.filter.enabled=true;$(i.filter.field).on("input",function(e){e.preventDefault();n($(this).val())});$(i.filter.field).on("focusout",function(e){e.preventDefault();n($(this).val())})};this.getSelectedItem=function(){return i.selected[0]};this.getSelectedItems=function(){return i.selected};this.getItem=function(e,t){for(var l=0;l<i.list.length;l++){if(i.list[l][e]){if(i.list[l][e]===t){return i.list[l]}}}};this.selectItems=function(e,l,n){var r;var s=[];for(var a=0;a<i.list.length;a++){if(i.list[a][e]){if(i.list[a][e]===l){i.selected.push(i.list[a]);s.push(i.list[a]);r=a;if(i.bind.pager&&i.limit){r=a+i.bind.pager.getPage()*i.limit}else{$(i.container).find(".ogx_dynamic_list_item:eq("+a+")").addClass("ogx_dynamic_list_selected_item")}}}}if(!n){t.renderList()}return s};this.selectList=function(e,l,n){for(var r=0;r<i.list.length;r++){if(i.list[r].hasOwnProperty(e)){if(l.indexOf(i.list[r][e])!==-1){i.selected.push(i.list[r])}}}if(!n){t.renderList()}};this.updateSelectedItem=function(e){i.selected[0]=e;t.renderSelectedItem()};this.renderSelectedItem=function(){var e=$(i.list_container).find(".ogx_dynamic_list_selected_item");var t=d(i.selected[0]);$(e).html(t)};this.resetSelection=function(){$(i.list_container).find(".ogx_dynamic_list_selected_item").removeClass("ogx_dynamic_list_selected_item");i.selected=[]};this.addItem=function(e,l){i.list.push(e);if(i.filter.enabled&&i.filter.val){i.filter.list=f(i.filter.prop,i.filter.val)}if(l){if(i.mode=="multi"){i.selected.push(e)}else{i.selected=[e]}}t.renderList()};this.addItemAt=function(e,l){var n=i.list.splice(0,l-1);n.push(e);var r=i.list.splice(l);i.list=n.concat(r);if(i.filter.enabled&&i.filter.val){i.filter.list=f(i.filter.prop,i.filter.val)}t.renderList()};this.removeItem=function(e,l){for(var n=0;n<i.list.length;n++){if(i.list[n][e]){if(i.list[n][e]===l){i.list.splice(n,1);if(i.filter.enabled&&i.filter.val){i.filter.list=f(i.filter.prop,i.filter.val)}t.renderList();return true}}}return false};this.removeSelectedItems=function(){var e;while(i.selected.length>0){for(var l=0;l<i.list.length;l++){e=_(i.list[l],i.selected[0]);if(e){i.list.splice(l,1);i.selected.splice(0,1);l--;if(i.selected.length===0){break}}}}if(i.filter.enabled&&i.filter.val){i.filter.list=f(i.filter.prop,i.filter.val)}t.renderList()};this.updateItem=function(e,l,n){for(var r=0;r<i.list.length;r++){if(i.list[r][e]===l){i.list[r]=n;break}}if(i.filter.enabled&&i.filter.val){i.filter.list=f(i.filter.prop,i.filter.val)}t.renderList()};this.renderBlock=function(e,l){if(l){i.limit=l}i.start=e*i.limit;t.renderList()};this.renderList=function(){if(i.filter.enabled&&i.filter.val){c(i.filter.list)}else{c(i.list)}};this.sortList=function(e,l){if(i.list){p(e,l);if(i.filter.enabled&&i.filter.val){i.filter.list=f(i.filter.prop,i.filter.val)}t.renderList()}};this.destroy=function(){t.disableFilter();s(false);a(false);$(i.list_container).off("click",".ogx_dynamic_list_item")};function n(e){e=e.trim();if(e.length>0){i.filter.val=e;i.filter.list=f(i.filter.prop,e)}else{i.filter.val=null}if(i.bind.pager){i.bind.pager.setPageBlock(0);i.bind.pager.setPage(0)}t.renderList()}function r(){}function s(e){if(e){$(i.bind.pager.el).on(OGX.DynamicPager.SELECT_PAGE,function(e,l){i.start=l.page*i.limit;t.renderList()})}else{if(i.bind.pager){$(i.bind.pager.el).off(OGX.DynamicPager.SELECT_PAGE)}}}function a(e){if(e){$(i.bind.tag.el).on(OGX.TagManager.TAG_ADDED+" "+OGX.TagManager.TAG_REMOVED,function(e,l){var n=i.bind.tag.getCurrentTags();n=n.join(" ");i.filter.val=n;i.filter.list=f(i.filter.prop,n);t.renderList()})}else{if(i.bind.tag){$(i.bind.tag.el).off(OGX.TagManager.TAG_ADDED+" "+OGX.TagManager.TAG_REMOVED)}}}function f(e,t){var l=[];var n;for(var r=0;r<i.list.length;r++){n=i.list[r][e].toLowerCase();if(n.indexOf(t.toLowerCase())!==-1){l.push(i.list[r])}}return l}function c(e){t.clearList();if(typeof e==="undefined"||e.length===0){return}var l=0;var n=e.length-1;if(i.limit){n=i.limit}if(i.start){l=i.start}n=l+n;n>e.length?n=e.length:null;if(i.limit){i.pages=Math.ceil(e.length/i.limit)}if(i.bind.pager){i.bind.pager.setPages(i.pages)}var r;var s;var a;for(var f=l;f<n;f++){r='<li class="ogx_dynamic_list_item';s=m(e[f]);if(e[f].hasOwnProperty("css")){r+=" "+e[f].css}if(i.css){r+=" "+i.css}if(s){r+=' ogx_dynamic_list_selected_item">'}else{r+='">'}r+=d(e[f]);r+="</li>";if(i.components){a=$(i.list_container).append(r).get(0)}else{$(i.list_container).append(r)}}if(i.bind_trigger){$(i.container).trigger(OGX.DynamicList.RENDER)}}function o(e){var t=i.template;var l=[];var n=/%[a-zA-Z]+\(([a-zA-Z0-9:\{\}\-_" ,\[\]]+)\)%/g;var r=n.exec(t);if(r){var s;var a;for(var f=0;f<r.length;f++){a=$.parseJSON(r[f][1]);a.container=e;var s=new window["OGX"]["TagManager"](a);l.push(s);console.log(s)}}else{console.log("no component in "+t)}return l}function d(e){var t=i.template;var l;for(var n in e){l=new RegExp("\\$"+n,"g");t=t.replace(l,e[n])}return t}function u(){$(i.list_container).on("click",".ogx_dynamic_list_item",function(e){if(i.enabled){var t=$(e.currentTarget).index();if(i.bind.pager&&i.limit){t=t+i.bind.pager.getPage()*i.limit}if(i.mode==="multi"){if($(this).hasClass("ogx_dynamic_list_selected_item")){$(this).removeClass("ogx_dynamic_list_selected_item");if(i.filter.enabled&&i.filter.val){g(i.filter.list[t]);$(i.container).trigger(OGX.DynamicList.UNSELECT,i.filter.list[t])}else{g(i.list[t]);$(i.container).trigger(OGX.DynamicList.UNSELECT,i.list[t])}return}else{$(this).addClass("ogx_dynamic_list_selected_item");if(i.filter.enabled&&i.filter.val){i.selected.push(i.filter.list[t]);$(i.container).trigger(OGX.DynamicList.SELECT,i.filter.list[t])}else{i.selected.push(i.list[t]);$(i.container).trigger(OGX.DynamicList.SELECT,i.list[t])}return}}else{if(i.mode==="toggle"){if($(this).hasClass("ogx_dynamic_list_selected_item")){$(this).removeClass("ogx_dynamic_list_selected_item");i.selected=[];if(i.filter.enabled&&i.filter.val){$(i.container).trigger(OGX.DynamicList.UNSELECT,i.filter.list[t])}else{$(i.container).trigger(OGX.DynamicList.UNSELECT,i.list[t])}return}else{$(i.list_container).find(".ogx_dynamic_list_item").removeClass("ogx_dynamic_list_selected_item");$(this).addClass("ogx_dynamic_list_selected_item");if(i.filter.enabled&&i.filter.val){i.selected.push(i.filter.list[t]);$(i.container).trigger(OGX.DynamicList.SELECT,i.filter.list[t])}else{i.selected.push(i.list[t]);$(i.container).trigger(OGX.DynamicList.SELECT,i.list[t])}return}}else{if($(i.list_container).find(".ogx_dynamic_list_selected_item")[0]==$(this)[0]){return}$(i.list_container).find(".ogx_dynamic_list_selected_item").removeClass("ogx_dynamic_list_selected_item");$(this).addClass("ogx_dynamic_list_selected_item");if(i.filter.enabled&&i.filter.val){i.selected=[i.filter.list[t]];$(i.container).trigger(OGX.DynamicList.SELECT,i.filter.list[t])}else{i.selected=[i.list[t]];$(i.container).trigger(OGX.DynamicList.SELECT,i.list[t])}return}}}})}function g(e){var t=false;for(var l=0;l<i.selected.length;l++){t=_(e,i.selected[l]);if(t){i.selected.splice(l,1);return true}}return false}function m(e){var t=false;for(var l=0;l<i.selected.length;l++){t=_(e,i.selected[l]);if(t){return true}}return false}function _(e,t){if(i.key){if(e[i.key]===t[i.key]){return true}return false}else{for(var l in e){if(t[l]!==e[l]){return false}}return true}}function p(e,t){var l=i.list;l.sort(h(e,t));return l}function h(e,t){return function(i,l){return i[e]<l[e]?t*-1:i[e]>l[e]?t:0}}function v(e){if(e.length===0||!e){$(i.list_container).find(".ogx_dynamic_list_item").css("display","block");return true}var t;var l;$(i.container).trigger(OGX.DynamicList.FILTER,{displayed:displayedItems,pages:Math.ceil(displayedItems/i.limit)});return true}function y(){if(!i){i={}}for(var e in l){if(!i[e]){i[e]=l[e]}}t.el=$(i.container)}function b(){y();$(i.container).append('<ul class="ogx_dynamic_list"></ul>');i.list_container=$(i.container).find(".ogx_dynamic_list:first");if(i.list){c(i.list)}u()}b()};OGX.DynamicList=function(e){"use strict";return new OGX.prototype.DynamicList(e)};OGX.DynamicList.SELECT="select";OGX.DynamicList.UNSELECT="unselect";OGX.DynamicList.FILTER="filter";OGX.DynamicList.RENDER="render";