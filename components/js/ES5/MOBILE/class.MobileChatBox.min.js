if("undefined"==typeof OGX)var OGX=function(){};OGX.prototype.MobileChatBox=function(e){"use strict";function o(){if(S.messages.length>0){for(var e=0;e<S.messages.length;e++)t(S.messages[e]);M.update(),M.bottom()}}function t(e){var o=_(e),t=r(e,o);O.append(t);var a=O.children(".ogx_mobile_chat_box_message:last");setTimeout(function(){a.addClass("ogx_mobile_chat_box_message_anim"),M.update(),M.bottom()},100)}function a(e){D[e]=!0;var o='<div class="ogx_mobile_chat_box_typing" data-user="'+e+'"><span class="ogx_mobile_chat_box_typing_body">.</div></div>';O.append(o),s(!0)}function n(e){D[e]=!1,O.find('.ogx_mobile_chat_box_typing[data-user="'+e+'"]').remove(),0===O.find(".ogx_mobile_chat_box_typing").length&&s(!1)}function s(e){e?w||(w=setInterval(i,S.dot_speed)):(clearInterval(w),w=null)}function i(){B+=".",B.length>3?B=".":null,O.find(".ogx_mobile_chat_box_typing_body").html(B)}function _(e){return e.from.toString()===S.users.current?S.template_right:S.template_left}function r(e,o){var t=o;for(var a in e)reg=new RegExp("\\$"+a,"g"),t=t.replace(reg,e[a]);return reg=new RegExp("\\$user","g"),t=t.replace(reg,e.from),reg=new RegExp("\\$letter","g"),t=t.replace(reg,S.users[e.from].name.substr(0,1).toUpperCase())}function l(){var e=C.find("textarea:first").val(),o=new Date;if(e.length>0){e=e.replace(/[\r\n]/g,"<br>");var a={from:S.users.current,to:S.users.remote,message:e,date:o.toISOString().split("T").shift()};t(a),C.find("textarea:first").val(""),G.el.trigger(OGX.MobileChatBox.SEND_MSG,a)}}function c(e){k=y.height(),y.height(y.height()-e.keyboardHeight),g()}function d(){y.height(k),g()}function g(){setTimeout(function(){M.update(),M.bottom()},S.on_keyb_update_delay)}function b(e){e?(window.addEventListener("native.keyboardshow",c),window.addEventListener("native.keyboardhide",d)):(window.removeEventListener("native.keyboardshow",c),window.removeEventListener("native.keyboardhide",d))}function h(e){e?C.on("keyup","textarea",function(e){13===e.which&&(l(),S.hide_keyboard_on_send&&d())}):C.off("keyup","textarea")}function m(e){e?C.on("click",".ogx_mobile_chat_box_composer_send",function(){l(),S.hide_keyboard_on_send&&d()}):C.off("click",".ogx_mobile_chat_box_composer_send")}function p(){M=new OGX.MobileScrollContainer({container:G.el.find(".ogx_mobile_chat_box_messages:first")[0],initDelay:100,autoScroll:!0,naturalScroll:S.natural_scroll}),G.el.on(OGX.MobileScrollContainer.READY,function(){G.el.off(OGX.MobileScrollContainer.READY),O=M.getInner(),O=$(O),O.addClass("ogx_mobile_chat_box_messages_inner"),M.update(),o()})}function u(){var e='<div class="ogx_mobile_chat_box_messages"></div><div class="ogx_mobile_chat_box_composer">';e+='<span class="ogx_mobile_chat_box_composer_input"><textarea placeholder="'+S.placeholder+'">',e+='</textarea></span><span class="ogx_mobile_chat_box_composer_send"></span></div>',y.append(e),C=y.find(".ogx_mobile_chat_box_composer:first")}function f(){for(var e in S.users)D[e]=!1}function x(){for(var e in X)S.hasOwnProperty(e)||(S[e]=X[e]);G.el=y=$(S.container),y.addClass("ogx_mobile_chat_box")}function v(){return"undefined"==typeof OGX.MobileScrollContainer?void console.log("%c CRITICAL ERROR - OGX.MobileScrollContainer not found! ","background:#222; color: #FF0000"):(x(),u(),f(),p(),S.handle_keyboard&&b(!0),m(!0),h(!0),E=$(window).height(),void console.log("WH",E))}var y,O,M,C,w,k,E,G=this,S=e,X={placeholder:"Type a message",dot_speed:600,on_keyb_update_delay:200,messages:[],natural_scroll:!0,handle_keyboard:!0,hide_keyboard_on_send:!1,mode:OGX.MobileChatBox.MODE_DESKTOP,template_left:'<div class="ogx_mobile_chat_box_message ogx_mobile_chat_box_message_left" data-user="$user"><span class="ogx_mobile_chat_box_message_icon"><span>$letter</span></span><span class="ogx_mobile_chat_box_message_container"><span class="ogx_mobile_chat_box_message_body">$message</span><span class="ogx_mobile_chat_box_message_date">$date</span><span style="clear:both"></span></span></div>',template_right:'<div class="ogx_mobile_chat_box_message ogx_mobile_chat_box_message_right" data-user="$user"><span class="ogx_mobile_chat_box_message_container"><span class="ogx_mobile_chat_box_message_body">$message</span><span class="ogx_mobile_chat_box_message_date">$date</span><span style="clear:both"></span></span></div>'},D={},B=".";this.el=null,this.setUsers=function(e){S.users=e},this.setRemote=function(e){S.remote=e},this.addMessage=function(e){t(e)},this.setMessages=function(e){S.messages=e,o()},this.userTyping=function(e,o){e&&!D[o]?a(o):!e&&D[o]&&n(o)},this.setCompose=function(e){C.find("textarea:first").val(e)},this.clear=function(){O.empty()},this.destroy=function(){b(!1),h(!1),m(!1)},v()},OGX.MobileChatBox=function(e){"use strict";return new OGX.prototype.MobileChatBox(e)},OGX.MobileChatBox.MODE_DESKTOP="desktop",OGX.MobileChatBox.MODE_MOBILE="mobile",OGX.MobileChatBox.SEND_MSG="MobileChatBoxSend";