if("undefined"==typeof OGX)var OGX=function(){};OGX.prototype.MobileChatBox=function(e){"use strict";function o(){if(y.empty(),E.messages.length>0){for(var e=0;e<E.messages.length;e++)t(E.messages[e]);O.update(),O.bottom()}}function t(e){var o=r(e),t=l(e,o);y.append(t);var a=y.children(".ogx_mobile_chat_box_message:last");setTimeout(function(){a.addClass("ogx_mobile_chat_box_message_anim"),O.update(),O.bottom()},100)}function a(e){S[e]=!0;var o='<div class="ogx_mobile_chat_box_typing" data-user="'+e+'"><span class="ogx_mobile_chat_box_typing_body">.</div></div>';y.append(o),s(!0)}function n(e){S[e]=!1,y.find('.ogx_mobile_chat_box_typing[data-user="'+e+'"]').remove(),0===y.find(".ogx_mobile_chat_box_typing").length&&s(!1)}function s(e){e?w||(w=setInterval(i,E.dot_speed)):(clearInterval(w),w=null)}function i(){X+=".",X.length>3?X=".":null,y.find(".ogx_mobile_chat_box_typing_body").html(X)}function r(e){return e.from.toString()===E.users.current?E.template_right:E.template_left}function l(e,o){var t=o;for(var a in e)reg=new RegExp("\\$"+a,"g"),t=t.replace(reg,e[a]);return reg=new RegExp("\\$user","g"),t=t.replace(reg,e.from),reg=new RegExp("\\$letter","g"),t=t.replace(reg,E.users[e.from].name.substr(0,1).toUpperCase())}function _(){var e=M.find("textarea:first").val(),o=new Date;if(e.length>0){e=e.replace(/[\r\n]/g,"<br>");var a={from:E.users.current,to:E.users.remote,message:e,date:o.toISOString().split("T").shift()};t(a),M.find("textarea:first").val(""),C.el.trigger(OGX.MobileChatBox.SEND_MSG,a)}}function c(e){var o=-M.height()-e.keyboardHeight;M.css({transform:"translate3D(0px, "+o+"px, 0px)"});var t='<div class="ogx_mobile_chat_box_spacer" style="height:'+e.keyboardHeight+'px;"></div>';y.append(t)}function p(){M.css({transform:"translate3D(0px, "+-M.height()+"px, 0px)"}),y.find(".ogx_mobile_chat_box_spacer").remove()}function g(e){e?(window.addEventListener("native.keyboardshow",c),window.addEventListener("native.keyboardhide",p)):(window.removeEventListener("native.keyboardshow",c),window.removeEventListener("native.keyboardhide",p))}function d(e){e?M.on("keyup","textarea",function(e){13===e.which&&("undefined"!=typeof cordova&&cordova.plugins.Keyboard.close(),_())}):M.off("keyup","textarea")}function b(e){e?M.on("click",".ogx_mobile_chat_box_composer_send",function(){_(),p()}):M.off("click",".ogx_mobile_chat_box_composer_send")}function h(){var e=$(window).height(),o='<div class="ogx_mobile_chat_box_composer" style="top:'+e+'px;"><span class="ogx_mobile_chat_box_composer_input"><textarea placeholder="'+E.placeholder+'">';o+='</textarea></span><span class="ogx_mobile_chat_box_composer_send"></span></div>',v.prepend(o),M=v.find(".ogx_mobile_chat_box_composer:first"),e=M.height(),M.css("transform","translate3D(0px, "+-e+"px, 0px)"),C.el.height(C.el.height()-e)}function m(){O=new OGX.MobileScrollContainer({container:C.el[0],initDelay:100,autoScroll:!0}),C.el.on(OGX.MobileScrollContainer.READY,function(){C.el.off(OGX.MobileScrollContainer.READY),y=O.getInner(),y=$(y),y.addClass("ogx_mobile_chat_box"),o()})}function x(){for(var e in E.users)S[e]=!1}function f(){for(var e in G)E.hasOwnProperty(e)||(E[e]=G[e]);C.el=v=$(E.container)}function u(){return"undefined"==typeof OGX.MobileScrollContainer?void console.log("%c CRITICAL ERROR - OGX.MobileScrollContainer not found! ","background:#222; color: #FF0000"):(f(),h(),x(),m(),E.handle_keyboard&&g(!0),b(!0),void d(!0))}var v,y,O,M,w,C=this,E=e,G={placeholder:"Type a message",dot_speed:600,messages:[],handle_keyboard:!0,mode:OGX.MobileChatBox.MODE_DESKTOP,template_left:'<div class="ogx_mobile_chat_box_message ogx_mobile_chat_box_message_left" data-user="$user"><span class="ogx_mobile_chat_box_message_icon"><span>$letter</span></span><span class="ogx_mobile_chat_box_message_container"><span class="ogx_mobile_chat_box_message_body">$message</span><span class="ogx_mobile_chat_box_message_date">$date</span><span style="clear:both"></span></span></div>',template_right:'<div class="ogx_mobile_chat_box_message ogx_mobile_chat_box_message_right" data-user="$user"><span class="ogx_mobile_chat_box_message_container"><span class="ogx_mobile_chat_box_message_body">$message</span><span class="ogx_mobile_chat_box_message_date">$date</span><span style="clear:both"></span></span></div>'},S={},X=".";this.el=null,this.setUsers=function(e){E.users=e},this.setRemote=function(e){E.remote=e},this.addMessage=function(e){t(e)},this.setMessages=function(e){E.messages=e,o()},this.userTyping=function(e,o){e&&!S[o]?a(o):!e&&S[o]&&n(o)},this.setCompose=function(e){M.find("textarea:first").val(e)},this.clear=function(){y.empty()},this.destroy=function(){g(!1),d(!1),b(!1)},u()},OGX.MobileChatBox=function(e){"use strict";return new OGX.prototype.MobileChatBox(e)},OGX.MobileChatBox.MODE_DESKTOP="desktop",OGX.MobileChatBox.MODE_MOBILE="mobile",OGX.MobileChatBox.SEND_MSG="MobileChatBoxSend";