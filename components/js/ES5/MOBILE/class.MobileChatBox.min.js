if("undefined"==typeof OGX)var OGX=function(){};OGX.prototype.MobileChatBox=function(e){"use strict";function o(){y.empty();for(var e=0;e<E.messages.length;e++)t(E.messages[e])}function t(e){var o=r(e),t=l(e,o);y.append(t),setTimeout(function(){y.children('.ogx_mobile_chat_box_message[data-user="'+e.user+'"]').addClass("ogx_mobile_chat_box_message_anim")},100)}function n(e){S[e]=!0;var o='<div class="ogx_mobile_chat_box_typing" data-user="'+e+'"><span class="ogx_mobile_chat_box_typing_body">.</div></div>';y.append(o),s(!0)}function a(e){S[e]=!1,y.find('.ogx_mobile_chat_box_typing[data-user="'+e+'"]').remove(),0===y.find(".ogx_mobile_chat_box_typing").length&&s(!1)}function s(e){e?C||(C=setInterval(i,E.dot_speed)):(clearInterval(C),C=null)}function i(){X+=".",X.length>3?X=".":null,y.find(".ogx_mobile_chat_box_typing_body").html(X)}function r(e){return e.user.toString()===E.users.current?E.template_right:E.template_left}function l(e,o){var t=o;for(var n in e)reg=new RegExp("\\$"+n,"g"),t=t.replace(reg,e[n]);return reg=new RegExp("\\$letter","g"),t=t.replace(reg,E.users[e.user].name.substr(0,1).toUpperCase())}function c(){var e=M.find("textarea:first").val(),o=new Date;if(e.length>0){var n={user:E.users.current,msg:e,date:o.toISOString().split("T").shift()};t(n),M.find("textarea:first").val(""),w.el.trigger(OGX.MobileChatBox.SEND_MSG,n)}}function _(e){var o=-M.height()-e.keyboardHeight;M.css({transform:"translate3D(0px, "+o+"px, 0px)"})}function d(){M.css({transform:"translate3D(0px, "+-M.height()+"px, 0px)"}),c()}function g(e){e?(window.addEventListener("native.keyboardshow",_),window.addEventListener("native.keyboardhide",d)):(window.removeEventListener("native.keyboardshow",_),window.removeEventListener("native.keyboardhide",d))}function p(e){e?M.on("keyup","textarea",function(e){13===e.which&&("undefined"!=typeof cordova&&cordova.plugins.Keyboard.close(),c())}):M.off("keyup","textarea")}function u(e){e?M.on("click",".ogx_mobile_chat_box_composer_send",function(){d()}):M.off("click",".ogx_mobile_chat_box_composer_send")}function h(){var e=$(window).height(),o='<div class="ogx_mobile_chat_box_composer" style="top:'+e+'px;"><span class="ogx_mobile_chat_box_composer_input"><textarea placeholder="'+E.placeholder+'">';o+='</textarea></span><span class="ogx_mobile_chat_box_composer_send"></span></div>',v.prepend(o),M=v.find(".ogx_mobile_chat_box_composer:first"),e=M.height(),M.css("transform","translate3D(0px, "+-e+"px, 0px)"),w.el.height(w.el.height()-e)}function f(){O=new OGX.MobileScrollContainer({container:w.el[0],initDelay:100,autoScroll:!0}),w.el.on(OGX.MobileScrollContainer.READY,function(){w.el.off(OGX.MobileScrollContainer.READY),y=O.getInner(),y=$(y),y.addClass("ogx_mobile_chat_box"),o()})}function x(){for(var e in E.users)S[e]=!1}function b(){for(var e in G)E.hasOwnProperty(e)||(E[e]=G[e]);w.el=v=$(E.container)}function m(){return"undefined"==typeof OGX.MobileScrollContainer?void console.log("%c CRITICAL ERROR - OGX.MobileScrollContainer not found! ","background:#222; color: #FF0000"):(b(),h(),x(),f(),g(!0),u(!0),void p(!0))}var v,y,O,M,C,w=this,E=e,G={placeholder:"Type a message",dot_speed:600,messages:[],mode:OGX.MobileChatBox.MODE_DESKTOP,template_left:'<div class="ogx_mobile_chat_box_message ogx_mobile_chat_box_message_left" data-user="$user"><span class="ogx_mobile_chat_box_message_icon"><span>$letter</span></span><span class="ogx_mobile_chat_box_message_body">$msg</span></div>',template_right:'<div class="ogx_mobile_chat_box_message ogx_mobile_chat_box_message_right" data-user="$user"><span class="ogx_mobile_chat_box_message_body">$msg</span></div>'},S={},X=".";this.el=null,this.setUsers=function(e){E.users=e},this.addMessage=function(e){t(e)},this.setMessages=function(e){E.messages=e,o()},this.userTyping=function(e,o){e&&!S[o]?n(o):!e&&S[o]&&a(o)},this.setCompose=function(e){M.find("textarea:first").val(e)},this.clear=function(){y.empty()},this.destroy=function(){g(!1),p(!1),u(!1)},m()},OGX.MobileChatBox=function(e){"use strict";return new OGX.prototype.MobileChatBox(e)},OGX.MobileChatBox.MODE_DESKTOP="desktop",OGX.MobileChatBox.MODE_MOBILE="mobile",OGX.MobileChatBox.SEND_MSG="MobileChatBoxSend";