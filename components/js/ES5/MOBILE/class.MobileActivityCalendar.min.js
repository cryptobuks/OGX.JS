if("undefined"==typeof OGX)var OGX=function(){};OGX.prototype.MobileActivityCalendar=function(t){"use strict";function a(t){return t.hasOwnProperty("originalEvent")?t.originalEvent.changedTouches[0]:t}function e(t){t?$(window).on("resize",function(){var t=S.innerWidth(),a=s(P);P.css({transform:"translate3D("+(a-Math.abs(z.width-t))+"px, 0px, 0px)"}),z.width=t,$(".ogx_mobile_activity_calendar_days").css("width",3*z.width),$(".ogx_mobile_activity_calendar_day").css("width",z.width)}):$(window).off("resize")}function i(t){t?P.on(R,function(t){I=!1,L=0,U=(new Date).getTime(),t=a(t),W.x=t.pageX,W.y=t.pageY+P.parent(0).scrollTop(),i(!1),n(!0),o(!0)}):P.off(R)}function n(t){t?P.on(B,function(){n(!1),o(!1),j||i(!0)}):P.off(B)}function r(t){if(t){var e=!1;S.on(B,".ogx_mobile_activity_calendar_block",function(t){if(e=!1,t=a(t),Math.abs(W.x-t.pageX)<2&&Math.abs(W.y-t.pageY)<2&&(z.maxT?(new Date).getTime()-U<z.maxT&&(e=!0):e=!0),e){var i=u($(this));i.date=z.date,i.recurring=!f($(this)),S.trigger(OGX.MobileActivityCalendar.SELECT,i)}})}else S.off(B,".ogx_mobile_activity_calendar_block")}function o(t){t?(d(!0),P.on(N,function(t){t=a(t),I=!1,L=0,Math.abs(t.pageX-W.x)>Math.abs(t.pageY-W.y)&&(I=Math.abs(t.pageX-W.x),L=t.pageX-W.x>0?1:-1)})):(d(!1),P.off(N))}function d(t){t?J||(J=setInterval(c,10)):J&&(clearInterval(J),J=null)}function c(){if(I&&L){if(!z.allow_past&&1===L){var t=p(z.date);t=moment(t).format("YYYY-MM-DD");var a=moment().format("YYYY-MM-DD");if(moment(t).unix()<moment(a).unix())return}if(I>z.minX){F=z.width,F*=L,o(!1),l(!0),i(!1),j=!0,P.addClass("ogx_mobile_activity_anim");var e=s(P);P.css({transform:"translate3D("+(e+F)+"px, 0px, 0px)"})}}}function l(t){t?P.on("transitionend",function(){l(!1),S.trigger(OGX.MobileActivityCalendar.DAY_CHANGE,z.date),P.removeClass("ogx_mobile_activity_anim"),L===-1?h():y(),j=!1,i(!0)}):P.off("transitionend")}function s(t){var a=t.css("-webkit-transform");return a=a.substr(7),a=a.substr(0,a.length-1),a=a.split(","),Number(a[4])}function _(t,a){var e=t.split(":"),i=Number(e[0]),n=Number(e[1]),r=P.find('.ogx_mobile_activity_calendar_hour[data-hour="'+i+'"]:first');if(r.length>0){var o=r.position().top;o+=Math.round(n/60*T);var d=Math.ceil(Number(a.length)/60*T);return{y:o,h:d}}return!1}function u(t){var a={};return a.type=t.data("type"),a.category=z.data.categories[a.type],a.label=t.find("span:first").text(),a.start=t.data("start"),a.length=t.data("length"),a.owner=t.data("owner"),a.custom=t.data("custom"),a}function f(t){var a=moment(z.date).format("YYYY-MM-DD");return!!z.data.calendar.unique.hasOwnProperty(a)&&!!z.data.calendar.unique[a].hasOwnProperty(t.data("start"))}function v(t,a){return Math.max(t.top,a.top)<Math.min(t.bottom,a.bottom)}function m(t,a){var e,i,n,r,o,d,c,l,s,_;if(e=t.find(".ogx_mobile_activity_calendar_grid:first").height(),n=t.children(".ogx_mobile_activity_calendar_content:first"),i=n.children(".ogx_mobile_activity_calendar_stripe").length,i>0)for(var u=0;u<i;u++){if(r=n.children(".ogx_mobile_activity_calendar_stripe:eq("+u+")"),d=r.children(".ogx_mobile_activity_calendar_block").length,_=!0,!(d>0))return r;for(var f=0;f<d;f++)o=r.children(".ogx_mobile_activity_calendar_block:eq("+f+")"),c=o.position().top,l=o.height(),s=v({top:a.y,bottom:a.y+a.h},{top:c,bottom:c+l}),s&&(_=!1);if(_)return r}return n.append('<div class="ogx_mobile_activity_calendar_stripe" style="height:'+e+'px;"></div>'),n.children(".ogx_mobile_activity_calendar_stripe:last")}function y(){var t=p(z.date);z.date=t;var a=P.find(".ogx_mobile_activity_calendar_day:last").detach(),e=p(z.date);x(e)&&H.el.trigger(OGX.MobileActivityCalendar.FIRST_DAY,e),a.children(".ogx_mobile_activity_calendar_nav:first").text(e.toString().substr(0,15)),a.find(".ogx_mobile_activity_calendar_content:first").empty(),P.prepend(a);var i=M(e),n=w(e);(n||i)&&O(n,i,e.getDay(),P.find(".ogx_mobile_activity_calendar_day:first"));var r=s(P);P.css({transform:"translate3D("+(r-z.width)+"px, 0px, 0px)"})}function h(){var t=g(z.date);z.date=t;var a=P.find(".ogx_mobile_activity_calendar_day:first").detach(),e=g(z.date);b(e)&&H.el.trigger(OGX.MobileActivityCalendar.LAST_DAY,e),a.children(".ogx_mobile_activity_calendar_nav:first").text(e.toString().substr(0,15)),a.find(".ogx_mobile_activity_calendar_content:first").empty(),P.append(a);var i=M(e),n=w(e);(n||i)&&O(n,i,e.getDay(),P.find(".ogx_mobile_activity_calendar_day:last"));var r=s(P);P.css({transform:"translate3D("+(Math.abs(r)-z.width)*-1+"px, 0px, 0px)"})}function g(t){var a=new Date(t.toString());return new Date(a.getFullYear(),a.getMonth(),a.getDate()+1)}function p(t){var a=new Date(t.toString());return new Date(a.getFullYear(),a.getMonth(),a.getDate()-1)}function b(t){var a=moment(t).format("YYYY-MM-DD");return z.data.to===a}function x(t){var a=moment(t).format("YYYY-MM-DD");return z.data.from===a}function w(t){var a,e;for(var i in z.data.calendar.recurring)if(a=i.split("_"),a[0]=moment(a[0]+" 00:00:00").unix(),a[1]=moment(a[1]+" 23:59:59").unix(),e=moment(t).unix(),e>=a[0]&&e<=a[1])return z.data.calendar.recurring[i];return!1}function M(t){var a=moment(t).format("YYYY-MM-DD");return!(!z.data.calendar.unique||!z.data.calendar.unique.hasOwnProperty(a))&&z.data.calendar.unique[a]}function D(){H.el.find(".ogx_mobile_activity_calendar_content").empty();var t,a,e,i=z.date.getDay(),n=i-1,r=moment(z.date).subtract(1,"day");n<0?n=6:null;for(var o=0;o<3;o++)a=w(r.format("YYYY-MM-DD")),e=M(r.format("YYYY-MM-DD")),(a||e)&&(t=S.children(".ogx_mobile_activity_calendar_days:first").children(".ogx_mobile_activity_calendar_day:eq("+o+")"),O(a,e,n,t)),n++,n>6?n=0:null,r.add(1,"day");H.el.trigger(OGX.MobileActivityCalendar.RENDER)}function O(t,a,e,i){var n,r,o,d,c,l;if(X(),l={},l[e]={},a)for(var s in a)l[e].hasOwnProperty(s)?l[e][s]=a[s].concat(l[e][s]):l[e][s]=a[s];if(t&&t.hasOwnProperty(e))for(var s in t[e])l[e].hasOwnProperty(s)?l[e][s]=t[e][s].concat(l[e][s]):l[e][s]=t[e][s];for(var s in l[e])for(var u=0;u<l[e][s].length;u++)o=l[e][s][u],n=_(s,o),n&&(d=m(i,n),c=z.data.categories[o.type].color,r='<div class="ogx_mobile_activity_calendar_block" style="top:'+n.y+"px; height:"+n.h+"px; background-color:"+c+';" data-start="'+s+'" data-length="'+o.length+'" data-type="'+o.type+'" data-owner="'+o.owner+'" data-custom="'+o.custom+'"><span>'+o.label+"</span></div>",d.append(r));var f=i.find(".ogx_mobile_activity_calendar_content:first").children(".ogx_mobile_activity_calendar_stripe").length,v=Math.floor(z.width/f);i.find(".ogx_mobile_activity_calendar_content:first").children(".ogx_mobile_activity_calendar_stripe").each(function(t,a){$(a).css("width",v+"px")})}function Y(){switch(z.mode){case OGX.MobileActivityCalendar.MODE_MOBILE:R="touchstart",B="touchend",N="touchmove";break;case OGX.MobileActivityCalendar.MODE_DESKTOP:R="mousedown",B="mouseup",N="mousemove"}}function A(){for(var t=0;t<3;t++)q(t)}function C(t,a){switch(a){case 1:t<=11?t+="<span>am</span>":12===t?t+="<span>pm</span>":t=t-12+"<span>pm</span>";break;case 2:t<10?t="0"+t:null}return t}function q(t){for(var a,e,i=S.height()-P.find(".ogx_mobile_activity_calendar_nav:first").height(),n=z.day_end-z.day_start+1,r=Math.floor(i/n),o="",d=P.children(".ogx_mobile_activity_calendar_day:eq("+t+")").children(".ogx_mobile_activity_calendar_grid:first"),c=0;c<n;c++)a=z.day_start+c,e=z.ampm?C(a,1):C(a,2),o+='<div class="ogx_mobile_activity_calendar_hour" data-hour="'+a+'" style="height:'+r+'px;"><span class="ogx_mobile_activity_calendar_hour_label">'+e+"</span></div>";d.html(o),T=d.find(".ogx_mobile_activity_calendar_hour:first").height()}function X(){for(var t=[p(z.date),z.date,g(z.date)],a=S.find(".ogx_mobile_activity_calendar_days:first"),e=0;e<3;e++)a.children(".ogx_mobile_activity_calendar_day:eq("+e+")").children(".ogx_mobile_activity_calendar_nav:first").html(t[e].toString().substr(0,15))}function k(){for(var t=S.width(),a=0,e='<div class="ogx_mobile_activity_calendar_days" style="width:'+3*t+'px;">',i=0;i<3;i++)e+='<div class="ogx_mobile_activity_calendar_day" style="width:'+t+'px;">',e+='<div class="ogx_mobile_activity_calendar_nav"></div>',e+='<div class="ogx_mobile_activity_calendar_grid"></div>',e+='<div class="ogx_mobile_activity_calendar_content"></div>',e+="</div>",a+=t;e+="</div>",S.append(e),P=S.find(".ogx_mobile_activity_calendar_days:first"),P.css({transform:"translate3D("+-z.width+"px, 0, 0)"})}function E(){for(var t in K)z.hasOwnProperty(t)||(z[t]=K[t]);z.width=$(z.container).innerWidth(),z.height=$(z.container).innerHeight(),H.el=S=$(z.container),S.addClass("ogx_mobile_activity_calendar ogx_hw")}function G(){E(),Y(),k(),X(),A(),z.data&&setTimeout(D,250),i(!0),r(!0),e(!0)}var S,P,T,R,B,N,I,L,F,J,U,H=this,z=t,K={data:{calendar:{recurring:null,unique:null}},day_start:6,day_end:21,allow_past:!0,date:new Date,ampm:!0,mode:OGX.MobileActivityCalendar.MODE_MOBILE,minX:60,maxY:5,maxT:100},W={},j=!1;this.el=null,this.setData=function(t,a){"undefined"==typeof a&&(a=!0),z.data=t,a&&this.render()},this.setDate=function(t){z.date=t,D()},this.getDate=function(){return z.date},this.render=function(){D()},this.clear=function(){var t=z.width;z=JSON.parse(JSON.stringify(K)),z.date=new Date,z.width=t,this.render()},this.addBlock=function(t){t.recurring?H.addRecurringBlock(t):H.addUniqueBlock(t)},this.removeBlock=function(t){t.recurring?H.removeRecurringBlock(t):H.removeUniqueBlock(t)},this.addRecurringBlock=function(t,a){var e,i;"undefined"==typeof a?(i=z.date,e=w(i)):(i=t.date,e=w(i),e||(e=z.data.calendar.recurring[a]={}));var n=moment(i).day();e.hasOwnProperty(n)||(e[n]={}),e[n].hasOwnProperty(t.start)||(e[n][t.start]=[]);var r=$.parseJSON(JSON.stringify(t));return delete r.date,delete r.recurring,delete r.locked,delete r.category,e[n][t.start].push(r),D(),!0},this.removeRecurringBlock=function(t){var a=w(t.date);if(a){var e=moment(t.date).day();if(a[e].hasOwnProperty(t.start))for(var i,n=0;n<a[e][t.start].length;n++)if(i=a[e][t.start][n],i.type===t.type&&i.label===t.label&&i.owner===t.owner)return a[e][t.start].splice(n,1),0===a[e][t.start].length&&delete a[e][t.start],D(),!0}return!1},this.addUniqueBlock=function(t){return z.data.calendar.unique.hasOwnProperty(t.date)||(z.data.calendar.unique[t.date]=[]),z.data.calendar.unique[t.date].hasOwnProperty(t.start)||(z.data.calendar.unique[t.date][t.start]=[]),z.data.calendar.unique[t.date][t.start].push(t),D(),!0},this.removeUniqueBlock=function(t){if(z.data.calendar.unique.hasOwnProperty(t.date)&&z.data.calendar.unique[t.date].hasOwnProperty(t.start))for(var a=0;a<z.data.calendar.unique[t.date][t.start].length;a++){var e=z.data.calendar.unique[t.date][t.start][a];if(e.type===t.type&&e.label===t.label&&e.owner===t.owner){z.data.calendar.unique[t.date][t.start].splice(a,1),0===z.data.calendar.unique[t.date][t.start].length&&delete z.data.calendar.unique[t.date][t.start];var i=0;for(var n in z.data.calendar.unique[t.date]){i++;break}return i||delete z.data.calendar.unique[t.date],D(),!0}}return!1},this.destroy=function(){i(!1),n(!1),o(!1),l(!1),e(!1)},G()},OGX.MobileActivityCalendar=function(t){"use strict";return"undefined"==typeof moment?void console.log("%c CRITICAL ERROR - momentJS not found! ","background:#222; color: #FF0000"):new OGX.prototype.MobileActivityCalendar(t)},OGX.MobileActivityCalendar.MODE_DESKTOP="desktop",OGX.MobileActivityCalendar.MODE_MOBILE="mobile",OGX.MobileActivityCalendar.SELECT="mobileActivityCalendarSelect",OGX.MobileActivityCalendar.DAY_CHANGE="mobileActivityCalendarDayChange",OGX.MobileActivityCalendar.RENDER="mobileActivityCalendarRender",OGX.MobileActivityCalendar.FIRST_DAY="mobileActivityCalendarFirstDay",OGX.MobileActivityCalendar.LAST_DAY="mobileActivityCalendarLastDay";