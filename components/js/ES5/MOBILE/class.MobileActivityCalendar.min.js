if("undefined"==typeof OGX)var OGX=function(){};OGX.prototype.MobileActivityCalendar=function(t){"use strict";function a(t){return t.hasOwnProperty("originalEvent")?t.originalEvent.changedTouches[0]:t}function e(t){t?$(window).on("resize",function(){var t=P.innerWidth(),a=s(T);T.css({transform:"translate3D("+(Number(a[0])-Math.abs(K.width-t))+"px, 0px, 0px)"}),K.width=t,$(".ogx_mobile_activity_calendar_days").css("width",3*K.width),$(".ogx_mobile_activity_calendar_day").css("width",K.width)}):$(window).off("resize")}function i(t){t?T.on(S,function(t){I=!1,L=0,H=(new Date).getTime(),t=a(t),J.x=t.pageX,J.y=t.pageY+T.parent(0).scrollTop(),i(!1),n(!0),o(!0)}):T.off(S)}function n(t){t?T.on(B,function(t){n(!1),o(!1),j||i(!0)}):T.off(B)}function r(t){if(t){var e=!1;P.on(B,".ogx_mobile_activity_calendar_block",function(t){if(e=!1,t=a(t),Math.abs(J.x-t.pageX)<2&&Math.abs(J.y-t.pageY)<2&&(K.maxT?(new Date).getTime()-H<K.maxT&&(e=!0):e=!0),e){var i=u($(this));i.date=K.date,i.recurring=!f($(this)),P.trigger(OGX.MobileActivityCalendar.SELECT,i)}})}else P.off(B,".ogx_mobile_activity_calendar_block")}function o(t){t?(d(!0),T.on(N,function(t){t=a(t),I=!1,L=0,Math.abs(t.pageX-J.x)>Math.abs(t.pageY-J.y)&&(I=Math.abs(t.pageX-J.x),L=t.pageX-J.x>0?1:-1)})):(d(!1),T.off(N))}function d(t){t?U||(U=setInterval(c,10)):U&&(clearInterval(U),U=null)}function c(){if(I&&L){if(!K.allow_past&&1===L){var t=p(K.date);t=moment(t).format("YYYY-MM-DD");var a=moment().format("YYYY-MM-DD");if(moment(t).unix()<moment(a).unix())return}if(I>K.minX){F=K.width,F*=L,o(!1),l(!0),i(!1),j=!0,T.addClass("ogx_mobile_activity_anim");var e=s(T);T.css({transform:"translate3D("+(Number(e[0])+F)+"px, 0px, 0px)"})}}}function l(t){t?T.on("transitionend",function(t){l(!1),P.trigger(OGX.MobileActivityCalendar.DAY_CHANGE,K.date),T.removeClass("ogx_mobile_activity_anim"),L===-1?h():y(),j=!1,i(!0)}):T.off("transitionend")}function s(t){var a=t.css("-webkit-transform").match(/matrix(?:(3d)\(-{0,1}\d+(?:, -{0,1}\d+)*(?:, (-{0,1}\d+))(?:, (-{0,1}\d+))(?:, (-{0,1}\d+)), -{0,1}\d+\)|\(-{0,1}\d+(?:, -{0,1}\d+)*(?:, (-{0,1}\d+))(?:, (-{0,1}\d+))\))/);return a?"3d"==a[1]?a.slice(2,5):(a.push(0),a.slice(5,8)):[0,0,0]}function _(t,a){var e=t.split(":"),i=Number(e[0]),n=Number(e[1]),r=T.find('.ogx_mobile_activity_calendar_hour[data-hour="'+i+'"]:first');if(r.length>0){var o=r.position().top;o+=Math.round(n/60*R);var d=Math.ceil(Number(a.length)/60*R);return{y:o,h:d}}return!1}function u(t){var a={};return a.type=t.data("type"),a.category=K.data.categories[a.type],a.label=t.find("span:first").text(),a.start=t.data("start"),a.length=t.data("length"),a.owner=t.data("owner"),a}function f(t){var a=moment(K.date).format("YYYY-MM-DD");return!!K.data.calendar.unique.hasOwnProperty(a)&&!!K.data.calendar.unique[a].hasOwnProperty(t.data("start"))}function v(t,a){return Math.max(t.top,a.top)<Math.min(t.bottom,a.bottom)}function m(t,a){var e,i,n,r,o,d,c,l,s,_;if(e=t.find(".ogx_mobile_activity_calendar_grid:first").height(),n=t.children(".ogx_mobile_activity_calendar_content:first"),i=n.children(".ogx_mobile_activity_calendar_stripe").length,i>0)for(var u=0;u<i;u++){if(r=n.children(".ogx_mobile_activity_calendar_stripe:eq("+u+")"),d=r.children(".ogx_mobile_activity_calendar_block").length,_=!0,!(d>0))return r;for(var f=0;f<d;f++)o=r.children(".ogx_mobile_activity_calendar_block:eq("+f+")"),c=o.position().top,l=o.height(),s=v({top:a.y,bottom:a.y+a.h},{top:c,bottom:c+l}),s&&(_=!1);if(_)return r}return n.append('<div class="ogx_mobile_activity_calendar_stripe" style="height:'+e+'px;"></div>'),n.children(".ogx_mobile_activity_calendar_stripe:last")}function y(){var t=p(K.date);K.date=t;var a=T.find(".ogx_mobile_activity_calendar_day:last").detach(),e=p(K.date);x(e)&&z.el.trigger(OGX.MobileActivityCalendar.FIRST_DAY,e),a.children(".ogx_mobile_activity_calendar_nav:first").text(e.toString().substr(0,15)),a.find(".ogx_mobile_activity_calendar_content:first").empty(),T.prepend(a);var i=M(e),n=w(e);(n||i)&&O(n,i,e.getDay(),T.find(".ogx_mobile_activity_calendar_day:first"));var r=s(T);T.css({transform:"translate3D("+(Number(r[0])-K.width)+"px, 0px, 0px)"})}function h(){var t=g(K.date);K.date=t;var a=T.find(".ogx_mobile_activity_calendar_day:first").detach(),e=g(K.date);b(e)&&z.el.trigger(OGX.MobileActivityCalendar.LAST_DAY,e),a.children(".ogx_mobile_activity_calendar_nav:first").text(e.toString().substr(0,15)),a.find(".ogx_mobile_activity_calendar_content:first").empty(),T.append(a);var i=M(e),n=w(e);(n||i)&&O(n,i,e.getDay(),T.find(".ogx_mobile_activity_calendar_day:last"));var r=s(T);T.css({transform:"translate3D("+(Math.abs(r[0])-K.width)*-1+"px, 0px, 0px)"})}function g(t){var a=new Date(t.toString());return new Date(a.getFullYear(),a.getMonth(),a.getDate()+1)}function p(t){var a=new Date(t.toString());return new Date(a.getFullYear(),a.getMonth(),a.getDate()-1)}function b(t){var a=moment(t).format("YYYY-MM-DD");return K.data.to===a}function x(t){var a=moment(t).format("YYYY-MM-DD");return K.data.from===a}function w(t){var a,e;for(var i in K.data.calendar.recurring)if(a=i.split("_"),a[0]=moment(a[0]+" 00:00:00").unix(),a[1]=moment(a[1]+" 23:59:59").unix(),e=moment(t).unix(),e>=a[0]&&e<=a[1])return K.data.calendar.recurring[i];return!1}function M(t){var a=moment(t).format("YYYY-MM-DD");return!!K.data.calendar.unique.hasOwnProperty(a)&&K.data.calendar.unique[a]}function D(){z.el.find(".ogx_mobile_activity_calendar_content").empty();var t,a,e,i=K.date.getDay(),n=i-1,r=moment(K.date).subtract(1,"day");n<0?n=6:null;for(var o=0;o<3;o++)a=w(r.format("YYYY-MM-DD")),e=M(r.format("YYYY-MM-DD")),(a||e)&&(t=P.children(".ogx_mobile_activity_calendar_days:first").children(".ogx_mobile_activity_calendar_day:eq("+o+")"),O(a,e,n,t)),n++,n>6?n=0:null,r.add(1,"day");z.el.trigger(OGX.MobileActivityCalendar.RENDER)}function O(t,a,e,i){var n,r,o,d,c,l;if(X(),l={},l[e]={},a)for(var s in a)l[e].hasOwnProperty(s)?l[e][s]=a[s].concat(l[e][s]):l[e][s]=a[s];if(t&&t.hasOwnProperty(e))for(var s in t[e])l[e].hasOwnProperty(s)?l[e][s]=t[e][s].concat(l[e][s]):l[e][s]=t[e][s];for(var s in l[e])for(var u=0;u<l[e][s].length;u++)o=l[e][s][u],n=_(s,o),n&&(d=m(i,n),c=K.data.categories[o.type].color,r='<div class="ogx_mobile_activity_calendar_block" style="top:'+n.y+"px; height:"+n.h+"px; background-color:"+c+';" data-start="'+s+'" data-length="'+o.length+'" data-type="'+o.type+'" data-owner="'+o.owner+'"><span>'+o.label+"</span></div>",d.append(r));var f=i.find(".ogx_mobile_activity_calendar_content:first").children(".ogx_mobile_activity_calendar_stripe").length,v=Math.floor(K.width/f);i.find(".ogx_mobile_activity_calendar_content:first").children(".ogx_mobile_activity_calendar_stripe").each(function(t,a){$(a).css("width",v+"px")})}function Y(){switch(K.mode){case OGX.MobileActivityCalendar.MODE_MOBILE:S="touchstart",B="touchend",N="touchmove";break;case OGX.MobileActivityCalendar.MODE_DESKTOP:S="mousedown",B="mouseup",N="mousemove"}}function A(){for(var t=0;t<3;t++)q(t)}function C(t,a){switch(a){case 1:t<=11?t+="<span>am</span>":12===t?t+="<span>pm</span>":t=t-12+"<span>pm</span>";break;case 2:t<10?t="0"+t:null}return t}function q(t){for(var a,e,i=P.height()-T.find(".ogx_mobile_activity_calendar_nav:first").height(),n=K.day_end-K.day_start+1,r=Math.floor(i/n),o="",d=T.children(".ogx_mobile_activity_calendar_day:eq("+t+")").children(".ogx_mobile_activity_calendar_grid:first"),c=0;c<n;c++)a=K.day_start+c,e=K.ampm?C(a,1):C(a,2),o+='<div class="ogx_mobile_activity_calendar_hour" data-hour="'+a+'" style="height:'+r+'px;"><span class="ogx_mobile_activity_calendar_hour_label">'+e+"</span></div>";d.html(o),R=d.find(".ogx_mobile_activity_calendar_hour:first").height()}function X(){for(var t=[p(K.date),K.date,g(K.date)],a=P.find(".ogx_mobile_activity_calendar_days:first"),e=0;e<3;e++)a.children(".ogx_mobile_activity_calendar_day:eq("+e+")").children(".ogx_mobile_activity_calendar_nav:first").html(t[e].toString().substr(0,15))}function E(){for(var t=P.width(),a=0,e='<div class="ogx_mobile_activity_calendar_days" style="width:'+3*t+'px;">',i=0;i<3;i++)e+='<div class="ogx_mobile_activity_calendar_day" style="width:'+t+'px;">',e+='<div class="ogx_mobile_activity_calendar_nav"></div>',e+='<div class="ogx_mobile_activity_calendar_grid"></div>',e+='<div class="ogx_mobile_activity_calendar_content"></div>',e+="</div>",a+=t;e+="</div>",P.append(e),T=P.find(".ogx_mobile_activity_calendar_days:first"),T.css({transform:"translate3D("+-K.width+"px, 0, 0)"})}function k(){for(var t in W)K.hasOwnProperty(t)||(K[t]=W[t]);K.width=$(K.container).innerWidth(),K.height=$(K.container).innerHeight(),z.el=P=$(K.container),P.addClass("ogx_mobile_activity_calendar ogx_hw")}function G(){k(),Y(),E(),X(),A(),K.data&&setTimeout(D,250),i(!0),r(!0),e(!0)}var P,T,R,S,B,N,I,L,F,U,H,z=this,K=t,W={day_start:6,day_end:21,allow_past:!0,date:new Date,ampm:!0,data:!1,mode:OGX.MobileActivityCalendar.MODE_MOBILE,minX:60,maxY:5,maxT:100},J={},j=!1;this.el=null,this.setData=function(t,a){if("undefined"==typeof a)var a=!0;K.data=t,a&&D()},this.setDate=function(t){K.date=t,D()},this.getDate=function(){return K.date},this.render=function(){D()},this.addBlock=function(t){t.recurring?z.addRecurringBlock(t):z.addUniqueBlock(t)},this.removeBlock=function(t){t.recurring?z.removeRecurringBlock(t):z.removeUniqueBlock(t)},this.addRecurringBlock=function(t,a){var e;"undefined"==typeof a?e=w(K.date):(e=w(t.date),e||(e=K.data.calendar.recurring[a]={}));var i=moment(t.date).day();return e.hasOwnProperty(i)||(e[i]={}),e[i].hasOwnProperty(t.start)||(e[i][t.start]=[]),e[i][t.start].push(t),D(),!0},this.removeRecurringBlock=function(t){var a=w(t.date);if(a){var e=moment(t.date).day();if(a[e].hasOwnProperty(t.start))for(var i=0;i<a[e][t.start].length;i++)if(a[e][t.start][i].type===t.type&&a[e][t.start][i].label===t.label&&a[e][t.start][i].owner===t.owner)return a[e][t.start].splice(i,1),0===a[e][t.start].length&&delete a[e][t.start],D(),!0}return!1},this.addUniqueBlock=function(t){return K.data.calendar.unique.hasOwnProperty(t.date)||(K.data.calendar.unique[t.date]=[]),K.data.calendar.unique[t.date].hasOwnProperty(t.start)||(K.data.calendar.unique[t.date][t.start]=[]),K.data.calendar.unique[t.date][t.start].push(t),D(),!0},this.removeUniqueBlock=function(t){if(K.data.calendar.unique.hasOwnProperty(t.date)&&K.data.calendar.unique[t.date].hasOwnProperty(t.start))for(var a=0;a<K.data.calendar.unique[t.date][t.start].length;a++){var e=K.data.calendar.unique[t.date][t.start][a];if(e.type===t.type&&e.label===t.label&&e.owner===t.owner){K.data.calendar.unique[t.date][t.start].splice(a,1),0===K.data.calendar.unique[t.date][t.start].length&&delete K.data.calendar.unique[t.date][t.start];var i=0;for(var n in K.data.calendar.unique[t.date]){i++;break}return i||delete K.data.calendar.unique[t.date],D(),!0}}return!1},this.destroy=function(){i(!1),n(!1),o(!1),l(!1),e(!1)},G()},OGX.MobileActivityCalendar=function(t){"use strict";return"undefined"==typeof moment?void console.log("%c CRITICAL ERROR - momentJS not found! ","background:#222; color: #FF0000"):new OGX.prototype.MobileActivityCalendar(t)},OGX.MobileActivityCalendar.MODE_DESKTOP="desktop",OGX.MobileActivityCalendar.MODE_MOBILE="mobile",OGX.MobileActivityCalendar.SELECT="mobileActivityCalendarSelect",OGX.MobileActivityCalendar.DAY_CHANGE="mobileActivityCalendarDayChange",OGX.MobileActivityCalendar.RENDER="mobileActivityCalendarRender",OGX.MobileActivityCalendar.FIRST_DAY="mobileActivityCalendarFirstDay",OGX.MobileActivityCalendar.LAST_DAY="mobileActivityCalendarLastDay";