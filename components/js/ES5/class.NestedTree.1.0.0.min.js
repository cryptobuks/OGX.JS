if(typeof OGX==="undefined"){var OGX=function(){}}OGX.prototype.NestedTree=function(e){var t=this;var s={scopes:["public"],arrow:"/img/more.png",padding:20,edit:true,dragAfter:1e3,openOnDrag:true,midThres:7};var r=e;var _,a,i,n,d,o,f,l;var g={x:0,y:0};var m=false;var p=false;var h={};this.el=null;this.setScopes=function(e){r.scopes=e};this.getData=function(){return r.data};this.destroy=function(){T(false)};function c(){var e,t,s;h={y:0,after:null,over:null};_.find(".ogx_nested_tree_item:visible").each(function(t,_){if(!$(_).hasClass("ogx_nested_tree_item_drag")){s=$(_).find(".ogx_nested_tree_item_head:first");e=$(_).position().top+s.height();if(Math.abs(l-(e-s.height()/2))<r.midThres){h.over=$(_);h.after=false;if(s.hasClass("ogx_nested_tree_item_arrow_closed")){G($(_))}return true}else{if(e<l){if(e>h.y){h.y=e;h.after=$(_)}}}}});if(h.over||h.after){_.find(".ogx_nested_tree_item_head_select").removeClass("ogx_nested_tree_item_head_select")}if(h.over){v(false);$(h.over).find(".ogx_nested_tree_item_head:first").addClass("ogx_nested_tree_item_head_select")}else{if(h.after){if(!p){v(true,h.after)}else{x(h.after.find(".ogx_nested_tree_item_head:first"))}t=p.width();var a=h.after.data("path").split("_");p.find(".ogx_nested_tree_bar_line:first").css("width",t-r.padding*(a.length-2)+"px")}}}function v(e,t){if(e){var s='<div class="ogx_nested_tree_bar"><span class="ogx_nested_tree_bar_line"></span></div>';t.after(s);p=_.find(".ogx_nested_tree_bar:first")}else{_.find(".ogx_nested_tree_bar:first").remove();p=false}}function x(e){var t=_.find(".ogx_nested_tree_bar:first").detach();e.after(t[0]);p=_.find(".ogx_nested_tree_bar:first")}function u(){if(h.over||h.after){d=_.find(".ogx_nested_tree_item_drag:first").detach();d.removeClass("ogx_nested_tree_item_drag");d.css("position","static");d.css("width","auto");d.css("left","");d.css("top","");v(false)}if(h.over){_.find(".ogx_nested_tree_item_head_select").removeClass("ogx_nested_tree_item_head_select");var e=b(h.over.find(".ogx_nested_tree_item_label:first").css("margin-left"));var t=h.over.find(".ogx_nested_tree_item_head:first");var s=h.over.find(".ogx_nested_tree_item_body:first");d.find(".ogx_nested_tree_item_label:first").css("margin-left",e+r.padding+"px");s.append(d[0]);if(!t.hasClass("ogx_nested_tree_item_arrow")){t.addClass("ogx_nested_tree_item_arrow").addClass("ogx_nested_tree_item_arrow_closed");s.addClass("ogx_nested_tree_body_hidden")}var a=y(d.data("path"),h.over.data("path"));if(!h.over.find(".ogx_nested_tree_item_head:first").hasClass("ogx_nested_tree_item_arrow_opened")){G(h.over)}}else{if(h.after){var s=h.after.parent(0);var i=h.after.data("path").split("_");i.pop();var n=i.length-1;i=i.join("_");var a=y(d.data("path"),i,h.after.index());if(d.data("path").slice(0,-2)===i){if(s.children(".ogx_nested_tree_item").length===h.after.index()+1){s.append(d[0])}else{s.find(".ogx_nested_tree_item:eq("+h.after.index()+")").after(d[0])}}else{s.find(".ogx_nested_tree_item:eq("+h.after.index()+")").after(d[0])}}}d.addClass("ogx_nested_tree_item");w();h.over=null;h.after=null;d=null}function w(){function e(t,s){var _,a,i;var n=0;t.children(".ogx_nested_tree_item").each(function(t,d){if(!$(d).hasClass("ogx_nested_tree_item_drag")){$(d).attr("data-path",s+"_"+n);a=s+"_"+n;a=a.split("_");a=a.length-2;$(d).find(".ogx_nested_tree_item_label:first").css("margin-left",r.padding*a);_=$(d).find(".ogx_nested_tree_item_body:first");i=$(d).find(".ogx_nested_tree_item_head:first");if(_.children(".ogx_nested_tree_item").length>0){if(!i.hasClass("ogx_nested_tree_item_arrow")){i.addClass("ogx_nested_tree_item_arrow");i.addClass("ogx_nested_tree_item_arrow_closed")}e(_,s+"_"+n)}else{i.removeClass("ogx_nested_tree_item_arrow");i.removeClass("ogx_nested_tree_item_arrow_opened");i.removeClass("ogx_nested_tree_item_arrow_closed")}n++}})}e(_,"0")}function y(e,t,s){if(typeof s==="undefined"){var s=false}var r=X(e);var _=e.split("_");var a=_.pop();_=_.join("_");var i=X(_);var n=X(t);if(i&&n){if(!n.hasOwnProperty("items")){n.items=[]}if(!s){n.items.push(r)}else{n.items.splice(s+1,0,r)}i.items.splice(a,1);return n}else{console.log("bug: obj not found!")}}function b(e){var t=e.split("px");return parseInt(t[0])}function C(e){if(e){$("body").on("mousemove",function(e){d.css("top",e.pageY+"px");l=e.pageY;c()})}else{$("body").off("mousemove")}}function O(e,t){if(e){o=t;f={path:t.data("path").split("_"),body:t.parent(0)};f.path.pop();m=false;n=true;a=(new Date).getTime();i=setInterval(s,20)}else{n=false;clearInterval(i);i=null;C(false)}function s(){if(n){var e=(new Date).getTime();if(e-a>=r.dragAfter&&!m){m=true;_.trigger(OGX.NestedTree.DRAG_START);var t=o.position().left;var s=o.width();d=o.detach();d.removeClass("ogx_nested_tree_item");d.addClass("ogx_nested_tree_item_drag");d.css("left",t+1+"px");d.css("top",g.y+"px");d.css("width",s+"px");_.prepend(d);C(true);w()}}}}function T(e){if(e){_.on("mousedown",".ogx_nested_tree_item_head",function(e){if(r.edit){g={x:e.pageX,y:e.pageY};O(true,$(this).parent(0));$("body").on("mouseup",function(e){O(false);if(m){m=false;u()}else{G(o);o=null;f=null}$("body").off("mouseup")})}else{G($(this).parent(0))}})}else{_.off("mousedown",".ogx_nested_tree_item_head");$("body").off("mouseup")}}function G(e){var t=e.find(".ogx_nested_tree_item_body:first");var s=X(e.data("path"));if(t.children().length>0){var r=e.find(".ogx_nested_tree_item_head:first");if(t.hasClass("ogx_nested_tree_body_hidden")){r.removeClass("ogx_nested_tree_item_arrow_closed");r.addClass("ogx_nested_tree_item_arrow_opened");t.removeClass("ogx_nested_tree_body_hidden");s.opened=true}else{r.removeClass("ogx_nested_tree_item_arrow_opened");r.addClass("ogx_nested_tree_item_arrow_closed");t.addClass("ogx_nested_tree_body_hidden");s.opened=false}}else{delete s.opened;var a=OGX.NestedTree.SELECT;if(e.data("event")){a=e.data("event")}_.trigger(a,s)}}function X(e){var t=e.split("_");var s=r.data;var _=t.slice();_.shift();while(_.length>0){if(s.hasOwnProperty("items")){s=s.items[_[0]]}_.shift()}return s}function N(){P(r.data,_,0,"0")}function P(e,t,s,_){t.empty();var a,i,n,d,o,f,l,g,m;if(e.hasOwnProperty("items")&&e.items){o=s*r.padding;for(var p=0;p<e.items.length;p++){d=" ogx_nested_tree_body_hidden";f="";l=false;g=_+"_"+p;if(e.items[p].hasOwnProperty("opened")&&e.items[p].opened){d="";l=true}else{e.items[p].opened=false}if(A(e.items[p])){i=false;if(e.items[p].hasOwnProperty("items")&&e.items[p].items.length>0){i=true;f=" ogx_nested_tree_item_arrow";if(l){f+=" ogx_nested_tree_item_arrow_opened"}else{f+=" ogx_nested_tree_item_arrow_closed"}}else{delete e.items[p].opened}a='<div class="ogx_nested_tree_item" data-path="'+g+'"><div class="ogx_nested_tree_item_head '+f+'"><span class="ogx_nested_tree_item_label" style="margin-left:'+o+'px;">'+e.items[p].label+'</span></div><div class="ogx_nested_tree_item_body'+d+'"></div></div>';t.append(a);n=t.find(".ogx_nested_tree_item:last").find(".ogx_nested_tree_item_body:first");if(i){P(e.items[p],n,s+1,g)}}}}}function A(e){if(e.hasOwnProperty("scopes")){for(var t=0;t<e.scopes.length;t++){if(r.scopes.indexOf(e.scopes[t])!==-1){return true}}}return false}function D(){for(var e in s){if(!r.hasOwnProperty(e)){r[e]=s[e]}}var a=r.data.slice();r.data={items:a};t.el=_=$(r.container);_.addClass("ogx_nested_tree")}function S(){D();N();T(true)}S()};OGX.NestedTree=function(e){return new OGX.prototype.NestedTree(e)};OGX.NestedTree.SELECT="select";OGX.NestedTree.DRAG_START="dragStart";