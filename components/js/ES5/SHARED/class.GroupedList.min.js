if("undefined"==typeof OGX)var OGX=function(){};OGX.prototype.GroupedList=function(r){"use strict";function e(r){for(var e in r){var o=t(e,r[e]);return o}return!1}function t(r,e){var t=f.list;return t.sort(o(r,e)),t}function o(r,e){var t=new RegExp("^[0-9]{4}-[0-9]{2}-[0-9]{2}$");return function(o,n){return t.test(o[r])?moment(o[r]).unix()<moment(n[r]).unix()?e*-1:moment(o[r]).unix()>moment(n[r]).unix()?e:0:o[r]<n[r]?e*-1:o[r]>n[r]?e:0}}function n(){for(var r,e={},t=0;t<f.list.length;t++)r=a(f.list[t]),r&&(e.hasOwnProperty(r)||(e[r]=[]),e[r].push({item:f.list[t],pos:t}));return e}function a(r){if(r.hasOwnProperty(f.group_by)){var e=r[f.group_by];if(!f.group_option)return e;switch(f.group_option){case"substr":return e=e.substr(f.group_param[0],f.group_param[1]);case"numrange":return e=Number(e),Array.isArray(f.group_param)?(e=Math.floor(e/f.group_param[0]),e="pre"===f.group_param[2]?f.group_param[1]+e*f.group_param[0]+" - "+f.group_param[1]+(e+1)*f.group_param[0]:e*f.group_param[0]+f.group_param[1]+" - "+(e+1)*f.group_param[0]+f.group_param[1]):(e=Math.floor(e/f.group_param),e=e*f.group_param+" - "+(e+1)*f.group_param),e;case"daterange":if(!Array.isArray(f.group_param)){if("year"===f.group_param)return e=e.substr(0,4);if("month"===f.group_param)return e=e.substr(0,7);if("week"===f.group_param)return e=e.substr(0,4)+" week "+moment(e).week()}return e=moment(e).unix(),e=Math.floor(e/(60*f.group_param[0]*60*24)),e*=60*f.group_param[0]*60*24,e=moment(1e3*e).format(f.group_param[1])+" - "+moment(1e3*e+1e3*f.group_param[0]*60*60*24).format(f.group_param[1])}}return!1}function u(r){var e,t,o=[];for(var n in r){t=f.group_option?n:r[n][0].item[f.group_by],e={title:t,body:"",scopes:["public"],open:!0};for(var a=0;a<r[n].length;a++)e.body+='<span class="ogx_groupedlist_item" data-id="'+r[n][a].pos+'">'+OGX.Templater.templatize(r[n][a].item,f.template)+"</span>";o.push(e)}return o}function i(r){r?d.el.on("click",".ogx_groupedlist_item",function(){d.el.find(".ogx_groupedlist_selected_item").removeClass("ogx_groupedlist_selected_item"),$(this).addClass("ogx_groupedlist_selected_item");var r=f.list[Number($(this).data("id"))];d.el.trigger(OGX.GroupedList.SELECT,r)}):d.el.off("click",".ogx_groupedlist_item")}function p(){for(var r in c)f.hasOwnProperty(r)||(f[r]=c[r]);d.el=l=$(f.container),l.addClass("ogx_grouped_list")}function s(){if("undefined"==typeof moment)return void console.log("%c CRITICAL ERROR - moment.js not found! ","background:#222; color: #FF0000");if("undefined"==typeof OGX.Templater)return void console.log("%c CRITICAL ERROR - OGX.Templater not found! ","background:#222; color: #FF0000");if("undefined"==typeof OGX.Templater)return void console.log("%c CRITICAL ERROR - OGX.NestedList not found! ","background:#222; color: #FF0000");p(),f.sort&&(g=e(f.sort)),g=n();var r=u(g);m=new OGX.NestedList({container:f.container,enabled:f.enabled,data:r}),f.enabled&&i(!0)}var l,m,g,d=this,f=r,c={group_by:"name",group_option:null,group_param:null,sort:null,template:"",enabled:!0,list:[]};this.el=null,this.enable=function(){f.enabled||(f.enabled=!0,i(!0),m.enable())},this.disable=function(){f.enabled&&(f.enabled=!1,i(!1),m.disable())},this.setList=function(){f.list=g,m.setData(u(g))},this.getList=function(){return f.list},this.sortList=function(r,e){var o=t(r,e);m.setData(u(o))},this.destroy=function(){i(!1),m.destroy()},s()},OGX.GroupedList=function(r){"use strict";return new OGX.prototype.GroupedList(r)},OGX.GroupedList.SELECT="select";