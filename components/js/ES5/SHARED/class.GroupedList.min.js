if("undefined"==typeof OGX)var OGX=function(){};OGX.prototype.GroupedList=function(r){"use strict";function t(r){for(var t in r){var o=e(t,r[t]);return o}return!1}function e(r,t){var e=_.list;return e.sort(o(r,t)),e}function o(r,t){var e=new RegExp("^[0-9]{4}-[0-9]{2}-[0-9]{2}$");return function(o,n){return e.test(o[r])?moment(o[r]).unix()<moment(n[r]).unix()?t*-1:moment(o[r]).unix()>moment(n[r]).unix()?t:0:o[r]<n[r]?t*-1:o[r]>n[r]?t:0}}function n(){for(var r,t={},e=0;e<_.list.length;e++)r=a(_.list[e]),r&&(t.hasOwnProperty(r)||(t[r]=[]),t[r].push({item:_.list[e],pos:e}));return t}function a(r){if(r.hasOwnProperty(_.group_by)){var t=r[_.group_by];if(!_.group_option)return t;switch(_.group_option){case"substr":return t=t.substr(_.group_param[0],_.group_param[1]);case"numrange":return t=Number(t),Array.isArray(_.group_param)?(t=Math.floor(t/_.group_param[0]),t="pre"===_.group_param[2]?_.group_param[1]+t*_.group_param[0]+" - "+_.group_param[1]+(t+1)*_.group_param[0]:t*_.group_param[0]+_.group_param[1]+" - "+(t+1)*_.group_param[0]+_.group_param[1]):(t=Math.floor(t/_.group_param),t=t*_.group_param+" - "+(t+1)*_.group_param),t;case"daterange":if(!Array.isArray(_.group_param)){if("year"===_.group_param)return t=t.substr(0,4);if("month"===_.group_param)return t=t.substr(0,7);if("week"===_.group_param)return t=t.substr(0,4)+" week "+moment(t).week()}return t=moment(t).unix(),t=Math.floor(t/(60*_.group_param[0]*60*24)),t*=60*_.group_param[0]*60*24,t=moment(1e3*t).format(_.group_param[1])+" - "+moment(1e3*t+1e3*_.group_param[0]*60*60*24).format(_.group_param[1])}}return!1}function u(r){var t,e,o=[];for(var n in r){e=_.group_option?n:r[n][0].item[_.group_by],t={title:e,body:"",scopes:["public"],open:!0};for(var a=0;a<r[n].length;a++)t.body+='<span class="ogx_grouped_list_item" data-id="'+r[n][a].pos+'">'+OGX.Templater.templatize(r[n][a].item,_.template)+"</span>";o.push(t)}return o}function i(r){r?d.el.on("click",".ogx_grouped_list_item",function(){d.el.find(".ogx_grouped_list_selected_item").removeClass("ogx_grouped_list_selected_item"),$(this).addClass("ogx_grouped_list_selected_item");var r=_.list[Number($(this).data("id"))];d.el.trigger(OGX.GroupedList.SELECT,r)}):d.el.off("click",".ogx_grouped_list_item")}function p(){for(var r in f)_.hasOwnProperty(r)||(_[r]=f[r]);d.el=l=$(_.container),l.addClass("ogx_grouped_list")}function s(){if("undefined"==typeof moment)return void console.log("%c CRITICAL ERROR - moment.js not found! ","background:#222; color: #FF0000");if("undefined"==typeof OGX.Templater)return void console.log("%c CRITICAL ERROR - OGX.Templater not found! ","background:#222; color: #FF0000");if("undefined"==typeof OGX.Templater)return void console.log("%c CRITICAL ERROR - OGX.NestedList not found! ","background:#222; color: #FF0000");p(),_.sort&&(g=t(_.sort)),g=n();var r=u(g);m=new OGX.NestedList({container:_.container,enabled:_.enabled,data:r}),_.enabled&&i(!0)}var l,m,g,d=this,_=r,f={group_by:"name",group_option:null,group_param:null,sort:null,template:"",enabled:!0,list:[]};this.el=null,this.enable=function(){_.enabled||(_.enabled=!0,i(!0),m.enable())},this.disable=function(){_.enabled&&(_.enabled=!1,i(!1),m.disable())},this.setList=function(){_.list=g,m.setData(u(g))},this.getList=function(){return _.list},this.sortList=function(r,t){var o=e(r,t);m.setData(u(o))},this.groupBy=function(r,e,o){_.group_by=r,"undefined"!=typeof e&&(_.group_option=e),"undefined"!=typeof group_param&&(_.group_param=o),_.sort&&(g=t(_.sort)),g=n(),m.setData(u(g))},this.destroy=function(){i(!1),m.destroy()},s()},OGX.GroupedList=function(r){"use strict";return new OGX.prototype.GroupedList(r)},OGX.GroupedList.SELECT="select";