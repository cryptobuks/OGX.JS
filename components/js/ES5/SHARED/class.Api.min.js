if("undefined"==typeof OGX)var OGX=function(){};OGX.prototype.API=function(e){"use strict";function r(e){var r=["id","logged"];for(var t in e)J.hasOwnProperty(t)&&r.indexOf(t)===-1&&(J[t]=e[t]);L.user=$.parseJSON(JSON.stringify(J))}function t(e,r){console.log("on user updated",e),e.success&&(L.user=$.parseJSON(JSON.stringify(J)),G(J),"undefined"!=typeof r&&r(e))}function n(e){for(var r=0;r<b.items.length;r++)if(b.items[r].services)for(var t=0;t<b.items[r].services.length;t++)if(b.items[r].services[t].name===e)return b.items[r].name;return!1}function s(e){for(var r=0;r<b.items.length;r++)if(b.items[r].services)for(var t=0;t<b.items[r].services.length;t++)if(b.items[r].services[t].name===e)return b.items[r].services[t];return!1}function i(e,r){var t={},n=s(e);if(n){if(o(n,r))return t={success:!1,error:OGX.API.SERVICE_UNEXPECTED_DATA};var i=u(n,r);if(!i.success)return i;var l=a(n,r);return l.success?(t.success=!0,n.hasOwnProperty("stored")&&(t.stored=n.stored),t):l}return t={success:!1,error:OGX.API.SERVICE_UNKNOWN}}function o(e,r){var t;if(e.fields)for(var n in r)if("token"!==n){t=!1;for(var s=0;s<e.fields.length;s++)if(n===e.fields[s].name){t=!0;break}if(!t)return console.log("extra data",n),!0}return!1}function u(e,r){var t={success:!0};if(e.fields)for(var n=0;n<e.fields.length;n++)e.fields[n].required&&(r.hasOwnProperty(e.fields[n].name)?String(r[e.fields[n].name])||(t.success=!1,t.error=OGX.API.SERVICE_REQUIRED_FIELDS_MISSING,t.fields||(t.fields=[]),t.fields.push(e.fields[n].name)):(t.success=!1,t.error=OGX.API.SERVICE_REQUIRED_FIELDS_MISSING,t.fields||(t.fields=[]),t.fields.push(e.fields[n].name)));return t}function a(e,r){var t={success:!1,fields:[]};if(e.fields)for(var n in r)for(var s=0;s<e.fields.length;s++)if(e.fields[s].name===n){if(e.fields[s].array&&e.fields[s].preg)for(var i=0;i<r[n].length;i++)l(e.fields[s].preg,r[n][i])||t.fields.indexOf(n)===-1&&t.fields.push({field:n,value:r[n][i],preg:e.fields[s].preg});else e.fields[s].preg&&String(r[n])&&(l(e.fields[s].preg,r[n])||t.fields.indexOf(n)===-1&&t.fields.push({field:n,value:r[n],preg:e.fields[s].preg}));break}return 0===t.fields.length?(delete t.fields,t.success=!0):t.error=OGX.API.SERVICE_INCORRECT_DATA,t}function l(e,r){var t=new RegExp(e[0],e[1]);return t.test(r)}function c(e,r,t,i,o){var u=window.location.href;b.base_url&&(u=b.base_url);var a=n(e),l=s(e),c=b.token.access_token;J.logged&&b.user_token&&(c=b.user_token.access_token);var f={uuid:b.uuid,service:e,model:a,data:r,access_token:c},d=new FormData;o&&d.append("file",o),d.append("data",JSON.stringify(f)),"ready"===j?$.ajax({method:"POST",url:u,data:d,async:!0,contentType:!1,processData:!1,success:function(e,n,s){if(e.success)1===parseInt(l.stored)&&I(l.name,r,e),t?i?t(e,i):t(e):$(document).trigger(OGX.API.SERVICE_DATA,e),S();else switch(e.error){case OGX.API.SESSION_EXPIRED:J.logged&&logOut(),$(document).trigger(OGX.API.SESSION_EXPIRED);break;case OGX.API.SCOPE_INVALID:J.logged&&logOut(),$(document).trigger(OGX.API.SCOPE_INVALID)}},error:function(e,r,t){}}):M.push({service:e,model:a,data:r,callback:t,params:i})}function f(){j="requestClientToken";var e;switch(b.env){case"app":e=b.base_url;break;case"web":e="/"}$.post(e,{action:"renewToken"},function(e){e.success?(b.token=e,"app"===b.env&&N(e),S()):$(document).trigger(OGX.API.SESSION_ERROR)},"json")}function d(e,r){j="verifyAccessToken",$.post(b.base_url,{uuid:b.uuid,token:e,grant_type:"token"},function(e){r(e)},"json")}function g(e){e.success?(J.logged=!0,j="ready",$(document).trigger(OGX.API.LOGIN_SUCCESS,J),$(document).trigger(OGX.API.SESSION_READY),S()):(b.user_token=!1,J.logged=!1,G(x),b.verify_on_start?d(b.token.access_token,O):(j="ready",$(document).trigger(OGX.API.SESSION_READY),S()))}function O(e){if(e.success)j="ready",$(document).trigger(OGX.API.SESSION_READY),S();else switch(e.error){case OGX.API.SESSION_EXPIRED:$(document).trigger(OGX.API.USER_SESSION_EXPIRED),b.renew_on_expired&&f();break;default:$(document).trigger(OGX.API.SESSION_ERROR)}}function S(){M.length>0?c(M[0].service,M[0].data,M[0].callback,M[0].params):(j="ready",$(document).trigger(OGX.API.SESSION_READY))}function I(e,r,t){var n=_(e,r);"string"==typeof t&&(t=$.parseJSON(t));var s=new Date;({hash:n,stored:s.getTime(),data:t});t=JSON.stringify(t),localStorage.setItem(n,t)}function E(e,r){var t=_(e,r),n=localStorage.getItem(t);return!!n&&$.parseJSON(n)}function _(e,r){var t=e+r.toString(),n=CryptoJS.SHA256(t);return n}function p(e,r,t,n){switch(b.env){case"web":$.post("/",{action:"logUserIn",username:e,password:r,user_data:n},function(s){A(s,e,r,t,n)},"json");break;case"app":$.post(b.base_url,{uuid:b.uuid,username:e,password:r,client_id:b.client_id,client_secret:b.client_secret,grant_type:"password"},function(n){A(n,e,r,t)},"json")}}function A(e,r,t,n,s){if(e.access_token){b.user_token=e;var i=e.scope.split(" ");for(var o in s)J[o]=s[o];J.email=r,J.logged=!0,J.scope=i,X(e),G(J),n?M.length>0&&(c(M[0].service,M[0].data,M[0].callback,M[0].params),M.shift()):$(document).trigger(OGX.API.LOGIN_SUCCESS)}else $(document).trigger(OGX.API.LOGIN_ERROR)}function R(){$.post("/",{action:"logUserOut"},function(e){e.success?$(document).trigger(OGX.API.LOGOUT_SUCCESS):$(document).trigger(OGX.API.LOGOUT_ERROR),k()},"json")}function P(){var e=!1;return e=b.debug||"undefined"==typeof device?"00000-0000-0000-00000":device.uuid}function v(){var e=localStorage.getItem("user");return!!e&&$.parseJSON(e)}function G(e){var r=JSON.stringify(e);r&&localStorage.setItem("user",r)}function m(){var e=localStorage.getItem("user_token");return!!e&&$.parseJSON(e)}function N(e){localStorage.setItem("client_token",JSON.stringify(e))}function X(e){localStorage.setItem("user_token",JSON.stringify(e))}function C(){localStorage.removeItem("user_token"),b.user_token=null}function k(){b.user_token=null,J=$.parseJSON(JSON.stringify(x)),G(J),C()}function y(e){e?$(window).on("focus",function(){}):$(window).off("focus")}function h(){b||(b={});for(var e in V)b.hasOwnProperty(e)||(b[e]=V[e])}function D(e,r){if(e){var t=new OGX[r](b.plugins[r]);return L.plugins[r]=t,!0}return L.plugins[r].kill&&L.plugins[r].kill(),L.plugins[r]=null,!0}function U(e){if(e){var r;for(var t in b.plugins)r=new OGX[t](b.plugins[t]),L.plugins[t]=r}else{for(var t in plugins)L.plugins[t].kill&&L.plugins[t].kill();L.plugins={}}}function T(){J=$.parseJSON(JSON.stringify(x));var e,t=!1;switch(b.env){case"web":e=v(),e&&(console.log("user loaded ",e),r(e),t=m(),t?(b.user_token=t,b.verify_on_start?d(b.user_token,g):(J.logged=!0,j="ready",$(document).trigger(OGX.API.LOGIN_SUCCESS,J),$(document).trigger(OGX.API.SESSION_READY))):(j="ready",J.logged=!1)),y(!0);break;case"app":b.uuid=P(),e=v(),e&&(r(e),t=m(),t&&(b.user_token=t,d(b.user_token,g)))}L.user=$.parseJSON(JSON.stringify(J))}function w(){return"undefined"==typeof CryptoJS?void $(document).trigger(OGX.API.CRITICAL_ERROR,"CryptoJS library missing, cannot continue"):(h(),T(),b.load_plugins&&U(!0),void(b.session||k()))}var J,L=this,b=e,V={renew_on_expired:!0,verify_on_start:!1,force_new_token:!1,load_plugins:!1,env:"app",debug:!1,uuid:null,token:null,user_token:null},x={id:null,email:null,first_name:null,last_name:null,image:null,city:null,country:null,state:null,zip:null,lat:null,lng:null,logged:!1,scope:["public"]},M=[],j="init";this.plugins={},this.type="RcpApi",this.user=null,this.setConfig=function(e){b=e},this.setPlugins=function(e){plugin_config=e},this.updateUser=function(e,n){delete e.scope,r(e);var s=$.parseJSON(JSON.stringify(J));delete s.id,delete s.logged,delete s.scope,delete s.image,delete s.first_name,delete s.last_name,delete s.email,L.call("updateUserCoreProfile",s,t,n)},this.setUser=function(e){r(e),L.user=$.parseJSON(JSON.stringify(J))},this.loadPlugin=function(e){return D(!0,e)},this.storeObject=function(e,r){localStorage.setItem(e,JSON.stringify(r))},this.getObject=function(e){var r=localStorage.getItem(e);return!!r&&$.parseJSON(r)},this.start=function(){w()},this.isLogged=function(){return J.logged},this.login=function(e,r,t,n){if(!t&&J.logged)return"already logged";var s=CryptoJS.MD5(r).toString();p(e,s,!1,n)},this.logout=function(){R()},this.call=function(e,r,t,n,s){if(!b.token&&!b.user_token)return void $(document).trigger(OGX.API.TOKEN_MISSING,null);var o=!1,u=i(e,r);if(u.success){if(u.stored){var a=E(e,r),l=new Date;parseInt(a.stored)+u.service.store_expire/1e3/60<l.getTime()?t?n?t(a.data,n):t(a.data):$(document).trigger(OGX.API.SERVICE_DATA,a.data):o=!0}else o=!0;o&&c(e,r,t,n,s)}else t?(u.front=!0,t(u)):$(document).trigger(OGX.API.SERVICE_INPUT_ERROR,u)},this.validate=function(e,r){var t=i(e,r);return t},this.getUUID=function(){return b.uuid},w()},OGX.API=function(e){"use strict";return new OGX.prototype.API(e)},OGX.API.SERVICE_INPUT_ERROR="serviceInputError",OGX.API.SERVICE_UNEXPECTED_DATA="serviceUnexpectedData",OGX.API.SERVICE_INCORRECT_DATA="serviceIncorrectData",OGX.API.SERVICE_REQUIRED_FIELDS_MISSING="serviceRequiredFieldsMissing",OGX.API.SERVICE_UNAVAILABLE="serviceUnavailable",OGX.API.SERVICE_UNKNOWN="serviceUnknown",OGX.API.SERVICE_DATA="serviceData",OGX.API.SERVICE_SPAM="serviceSpam",OGX.API.USER_SESSION_EXPIRED="userSessionExpired",OGX.API.SESSION_EXPIRED="expired_token",OGX.API.SESSION_INVALID="sessionInvalid",OGX.API.SESSION_READY="sessionReady",OGX.API.SESSION_ERROR="sessionError",OGX.API.SESSION_RESTART="sessionRestart",OGX.API.SCOPE_INVALID="scopeInvalid",OGX.API.LOGIN_ERROR="loginError",OGX.API.LOGIN_SUCCESS="loginSuccess",OGX.API.LOGOUT="logOut",OGX.API.LOGOUT_SUCCESS="logOutSuccess",OGX.API.LOGOUT_ERROR="logOutError",OGX.API.CRITICAL_ERROR="criticalError",OGX.API.TOKEN_MISSING="tokenMissing",OGX.API.ERROR_FILE_SIZE="errorFileSize",OGX.API.ERROR_GENERIC="errorGeneric",OGX.API.UPLOAD_START="uploadStart",OGX.API.UPLOAD_ABORTED="uploadAborted",OGX.API.UPLOAD_COMPLETE="uploadComplete",OGX.API.UPLOAD_PROGRESS="uploadProgress";