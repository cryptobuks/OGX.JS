if(typeof OGX==="undefined"){var OGX=function(){}}OGX.prototype.TreeView=function(e){"use strict";var t=this;var r=e;var i={show_root:true,root_label:"root",draggable:false,reorder:false,toggle:true,drag_after:500};var n;var o=false;var s;var a;var l;this.el=null;this.addObject=function(e,t){p(l.obj,e,t)};this.selectObject=function(e){w();return h(e)};this.deleteSelectedObject=function(){return x()};this.updateSelectedObject=function(e,t){if(e==="type"){return false}var r=O();if(r.obj){r.obj[e]=t;if(e==="label"){$(".ogx_tree_view_selected:first").next(".ogx_tree_view_item_label").html(t);return true}}return false};this.getTree=function(){var e=_();if(e){return e}};this.setTree=function(e){r.tree=e;c()};this.newTree=function(){f()};this.destroy=function(){};function f(){r.tree={type:"root",mode:"folder",label:r.root_label,element:null,scopes:[],items:[]};$(r.container).html('<div class="ogx_tree_view_root ogx_tree_view_item" data-type="root" data-mode="folder" data-level="1"><img src="'+d("root")+'"><div class="ogx_tree_view_item_label">'+r.root_label+'</div><div class="ogx_tree_view_container"></div></div>');r.tree.element=$(".ogx_tree_view_root:first")}function c(){var e="";if(!r.show_root){e='style="display:none"'}$(r.container).html('<div class="ogx_tree_view_root ogx_tree_view_item" data-type="root" data-mode="folder"><img src="'+d("root")+'" '+e+'><div class="ogx_tree_view_item_label" '+e+">"+r.root_label+'</div><div class="ogx_tree_view_container"></div></div>');r.tree.element=$(r.container).find(".ogx_tree_view_root:first");r.tree.label=r.root_label;u(r.tree,r.tree.element)}function _(){var e=$.parseJSON(JSON.stringify(r.tree));var t=v(e);if(t){return e}}function v(e){var t=0;function r(e){t++;if(e.element){delete e.element}if(e.items){for(var i=0;i<e.items.length;i++){r(e.items[i])}}t--;if(t===0){return true}}var i=r(e);if(i){return true}}function u(e,t){if(e.hasOwnProperty("items")){var i;if(!r.reorder){i=b(e.items,"type",1)}else{i=e.items}var n;var o;var s="";for(var a=0;a<i.length;a++){n=g(e.items[a].type);if(n){o=m(n,0);if(e.items[a].hasOwnProperty("state")){if(e.items[a].state==="closed"){s='style="display:none;"';o=m(n,1)}}$(t).children(".ogx_tree_view_container:last").append('<div data-type="'+e.items[a].type+'" data-mode="'+n.mode+'" class="ogx_tree_view_item ogx_tree_view_'+n.mode+'"><img src="'+o+'"><div class="ogx_tree_view_item_label">'+e.items[a].label+'</div><div class="ogx_tree_view_container" '+s+"></div></div>");e.items[a].element=$(t).children(".ogx_tree_view_container:last").children(".ogx_tree_view_item:last");u(e.items[a],e.items[a].element)}}}}function d(e,t){for(var i=0;i<r.types.length;i++){if(r.types[i].type===e){if(r.types[i].hasOwnProperty("icons")){if(t){return r.types[i].icons[t]}return r.types[i].icons[0]}return r.types[i].icon}}return false}function m(e,t){if(e.hasOwnProperty("icons")){if(t){return e.icons[t]}return e.icons[0]}return e.icon}function g(e){for(var t=0;t<r.types.length;t++){if(r.types[t].type===e){return r.types[t]}}return false}function p(e,t,r){var i=g(t.type);var n=m(i);$(e.element).children(".ogx_tree_view_container:first").append('<div class="ogx_tree_view_item ogx_tree_view_'+i.mode+'" data-type="'+t.type+'" data-mode="'+i.mode+'"><img src="'+n+'"><div class="ogx_tree_view_item_label">'+t.label+'</div><div class="ogx_tree_view_container"></div></div>');if(!e.items){e.items=[]}t.element=$(e.element).children(".ogx_tree_view_container:last").children(".ogx_tree_view_item:last");t.scopes=[];if(typeof r!=="undefined"){t.data=r}e.items.push(t);return t.element}function w(){$(r.container).find(".ogx_tree_view_selected").removeClass("ogx_tree_view_selected")}function h(e){var t=false;function i(r,o){if(o+"/"+r.label===e){r.element.find("img:first").addClass("ogx_tree_view_selected");t=true;return true}if(r.type==="folder"){if(r.hasOwnProperty("items")&&r.items.length>0){for(var s=0;s<r.items.length;s++){if(!t){n=i(r.items[s],o+"/"+r.label);if(n){return true}}}}}}var n=i(r.tree,"");if(n){return true}}function x(){var e=false;function t(r){if(r.items){for(var n=0;n<r.items.length;n++){if(!e){if($(r.items[n].element).find("img:first").hasClass("ogx_tree_view_selected")){e=true;$(r.items[n].element).remove();r.items.splice(n,1);l=null;return true}else{i=t(r.items[n]);if(i){l=null;return i}}}}}}var i=t(r.tree);if(i){l=null;return i}}function y(e){var t=false;function r(e,n){if($(e.element).find("img:first").hasClass("ogx_tree_view_selected")){t=true;return{obj:e,path:n+"/"+e.label}}else{if(e.hasOwnProperty("items")){for(var o=0;o<e.items.length;o++){if(!t){i=r(e.items[o],n+"/"+e.label);if(i){return i}}}}}}var i=r(e,"");if(i){return i}}function O(){var e=y(r.tree);if(e){return e}return false}function b(e,t,r){e.sort(T(t,r));return e}function T(e,t){return function(r,i){return r[e]<i[e]?t*-1:r[e]>i[e]?t:0}}function G(e,t){var r=e.data("type");console.log("render icon opened",t);if(t){e.children("img").attr("src",d(r,1))}else{e.children("img").attr("src",d(r,0))}}function X(e,t){var i,n,o,s,a;var l;$(r.container).find(".ogx_tree_view_item img").each(function(r,f){a=$(f).parent(".ogx_tree_view_item:first");i=$(f).offset().left;n=$(f).offset().top;o=$(f).width();s=$(f).height();if(e>=i&&e<=i+o){if(t>=n&&t<=n+s){l=a;return false}}});return l}function C(e){var t=false;function i(r){if($(r.element).is(e)){t=true;return r}else{if(r.items){for(var o=0;o<r.items.length;o++){if(!t){n=i(r.items[o]);if(n){t=true;return n}}}}}}var n=i(r.tree);if(n){return n}}function V(e,t){x();$(e.element).remove();p(t,e)}function E(e,t){var i=$.parseJSON(JSON.stringify(e));delete i.element;function n(e){if(e.items){for(var r=0;r<e.items.length;r++){if($(e.items[r].element).is(t.element)){e.items.splice(r,0,i);return true}else{var o=n(e.items[r]);if(o){return o}}}}}var o=n(r.tree);if(o){x();return o}}function S(e,t,r){n=e;o=true;$(e.element).css("opacity",.3);var i=e.element.data("mode");var s='<div class="ogx_tree_view_drag ogx_tree_view_item ogx_tree_view_'+i+'" style="top:+'+r+"px; left:"+t+'px;"><img src="'+d(e.type)+'"><div class="ogx_tree_view_item_label">'+e.label+"</div></div>";$("body").append(s);$(document).on("mousemove",function(e){e.preventDefault();$(".ogx_tree_view_drag:first").css("top",e.pageY+"px");$(".ogx_tree_view_drag:first").css("left",e.pageX+"px")});$(document).on("mouseup",function(e){e.preventDefault();N();j(e.pageX,e.pageY)})}function j(e,t){$(document).off("mousemove");$(document).off("mouseup");$(".ogx_tree_view_drag").remove();$(n.element).css("opacity",1);var i;var s=X(e,t);if(s){i=C(s)}if(r.reorder){if(i){if(i.type==="folder"){V(n,i)}else{var a=E(n,i);if(a){c()}}}}else{if(i){$(r.container).trigger(OGX.TreeView.DROP,{x:e,y:t,source:n,target:i})}}n=null;o=false}function D(){if(s){clearInterval(s)}a=Date.now();s=setInterval(P,100)}function P(){if(Date.now()-a>=r.drag_after){var e=O();if(e){S(e.obj,$(e.obj.element).offset().left,$(e.obj.element).offset().top);$(r.container).trigger(OGX.TreeView.DRAG,e);N()}}}function N(){if(s){clearInterval(s);s=null}}function L(){for(var e in i){if(!r.hasOwnProperty(e)){r[e]=i[e]}}}function J(e){if(r.toggle){if($(e).hasClass("ogx_tree_view_selected")){$(r.container).trigger(OGX.TreeView.UNSELECT,l);l=null;$(e).removeClass("ogx_tree_view_selected")}else{$(r.container+" .ogx_tree_view_selected").removeClass("ogx_tree_view_selected");$(e).addClass("ogx_tree_view_selected");l=O();$(r.container).trigger(OGX.TreeView.SELECT,l)}}else{$(r.container+" .ogx_tree_view_selected").removeClass("ogx_tree_view_selected");$(e).addClass("ogx_tree_view_selected");l=O();$(r.container).trigger(OGX.TreeView.SELECT,l)}}function R(){L();if(!r.draggable){$(r.container).on("click",".ogx_tree_view_item img",function(e){e.preventDefault();J(this)})}else{$(r.container).on("mousedown",".ogx_tree_view_item img",function(e){e.preventDefault();J(this);D();$(document).on("mouseup",function(){N()})})}$(r.container).on("dblclick",".ogx_tree_view_item img",function(e){e.preventDefault();N();if($(this).parent(0).children(".ogx_tree_view_container:first").children().length>0){$(this).parent(0).children(".ogx_tree_view_container:first").toggle();if($(this).parent(0).data("mode")==="folder"){var t=l.state;if(t==="closed"){G($(this).parent(0),true);l.state="opened";$(r.container).trigger(OGX.TreeView.OPEN,l)}else{G($(this).parent(0),false);l.state="closed";$(r.container).trigger(OGX.TreeView.CLOSE,l)}}}});t.el=$(r.container);if(r.tree){c()}}R()};OGX.TreeView=function(e){"use strict";return new OGX.prototype.TreeView(e)};OGX.TreeView.SELECT="select";OGX.TreeView.UNSELECT="unselect";OGX.TreeView.OPEN="open";OGX.TreeView.CLOSE="close";OGX.TreeView.DRAG="drag";OGX.TreeView.DROP="drop";