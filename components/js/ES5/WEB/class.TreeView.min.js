if("undefined"==typeof OGX)var OGX=function(){};OGX.prototype.TreeView=function(e){"use strict";function t(){L.tree={type:"root",mode:"folder",label:L.root_label,element:null,scopes:[],items:[]},$(L.container).html('<div class="ogx_tree_view_root ogx_tree_view_item" data-type="root" data-mode="folder" data-level="1"><img src="'+s("root")+'"><div class="ogx_tree_view_item_label">'+L.root_label+'</div><div class="ogx_tree_view_container"></div></div>'),L.tree.element=$(".ogx_tree_view_root:first")}function i(){var e="";L.show_root||(e='style="display:none"'),$(L.container).html('<div class="ogx_tree_view_root ogx_tree_view_item" data-type="root" data-mode="folder"><img src="'+s("root")+'" '+e+'><div class="ogx_tree_view_item_label" '+e+">"+L.root_label+'</div><div class="ogx_tree_view_container"></div></div>'),L.tree.element=$(L.container).find(".ogx_tree_view_root:first"),L.tree.label=L.root_label,o(L.tree,L.tree.element)}function r(){var e=$.parseJSON(JSON.stringify(L.tree)),t=n(e);if(t)return e}function n(e){function t(e){if(i++,e.element&&delete e.element,e.items)for(var r=0;r<e.items.length;r++)t(e.items[r]);if(i--,0===i)return!0}var i=0,r=t(e);if(r)return!0}function o(e,t){if(e.hasOwnProperty("items")){var i;i=L.reorder?e.items:u(e.items,"type",1);for(var r,n,s="",c=0;c<i.length;c++)r=l(e.items[c].type),r&&(n=a(r,0),e.items[c].hasOwnProperty("state")&&"closed"===e.items[c].state&&(s='style="display:none;"',n=a(r,1)),$(t).children(".ogx_tree_view_container:last").append('<div data-type="'+e.items[c].type+'" data-mode="'+r.mode+'" class="ogx_tree_view_item ogx_tree_view_'+r.mode+'"><img src="'+n+'"><div class="ogx_tree_view_item_label">'+e.items[c].label+'</div><div class="ogx_tree_view_container" '+s+"></div></div>"),e.items[c].element=$(t).children(".ogx_tree_view_container:last").children(".ogx_tree_view_item:last"),o(e.items[c],e.items[c].element))}}function s(e,t){for(var i=0;i<L.types.length;i++)if(L.types[i].type===e)return L.types[i].hasOwnProperty("icons")?t?L.types[i].icons[t]:L.types[i].icons[0]:L.types[i].icon;return!1}function a(e,t){return e.hasOwnProperty("icons")?t?e.icons[t]:e.icons[0]:e.icon}function l(e){for(var t=0;t<L.types.length;t++)if(L.types[t].type===e)return L.types[t];return!1}function c(e,t,i){var r=l(t.type),n=a(r);return $(e.element).children(".ogx_tree_view_container:first").append('<div class="ogx_tree_view_item ogx_tree_view_'+r.mode+'" data-type="'+t.type+'" data-mode="'+r.mode+'"><img src="'+n+'"><div class="ogx_tree_view_item_label">'+t.label+'</div><div class="ogx_tree_view_container"></div></div>'),e.items||(e.items=[]),t.element=$(e.element).children(".ogx_tree_view_container:last").children(".ogx_tree_view_item:last"),t.scopes=[],"undefined"!=typeof i&&(t.data=i),e.items.push(t),t.element}function _(){$(L.container).find(".ogx_tree_view_selected").removeClass("ogx_tree_view_selected")}function f(e){function t(n,o){if(o+"/"+n.label===e)return n.element.find("img:first").addClass("ogx_tree_view_selected"),i=!0,!0;if("folder"===n.type&&n.hasOwnProperty("items")&&n.items.length>0)for(var s=0;s<n.items.length;s++)if(!i&&(r=t(n.items[s],o+"/"+n.label)))return!0}var i=!1,r=t(L.tree,"");if(r)return!0}function d(){function e(r){if(r.items)for(var n=0;n<r.items.length;n++)if(!t){if($(r.items[n].element).find("img:first").hasClass("ogx_tree_view_selected"))return t=!0,$(r.items[n].element).remove(),r.items.splice(n,1),P=null,!0;if(i=e(r.items[n]))return P=null,i}}var t=!1,i=e(L.tree);if(i)return P=null,i}function m(e){function t(e,n){if($(e.element).find("img:first").hasClass("ogx_tree_view_selected"))return i=!0,{obj:e,path:n+"/"+e.label};if(e.hasOwnProperty("items"))for(var o=0;o<e.items.length;o++)if(!i&&(r=t(e.items[o],n+"/"+e.label)))return r}var i=!1,r=t(e,"");if(r)return r}function v(){var e=m(L.tree);return!!e&&e}function u(e,t,i){return e.sort(g(t,i)),e}function g(e,t){return function(i,r){return i[e]<r[e]?t*-1:i[e]>r[e]?t:0}}function p(e,t){var i=e.data("type");console.log("render icon opened",t),t?e.children("img").attr("src",s(i,1)):e.children("img").attr("src",s(i,0))}function w(e,t){var i,r,n,o,s,a;return $(L.container).find(".ogx_tree_view_item img").each(function(l,c){if(s=$(c).parent(".ogx_tree_view_item:first"),i=$(c).offset().left,r=$(c).offset().top,n=$(c).width(),o=$(c).height(),e>=i&&e<=i+n&&t>=r&&t<=r+o)return a=s,!1}),a}function h(e){function t(n){if($(n.element).is(e))return i=!0,n;if(n.items)for(var o=0;o<n.items.length;o++)if(!i&&(r=t(n.items[o])))return i=!0,r}var i=!1,r=t(L.tree);if(r)return r}function x(e,t){d(),$(e.element).remove(),c(t,e)}function y(e,t){function i(e){if(e.items)for(var n=0;n<e.items.length;n++){if($(e.items[n].element).is(t.element))return e.items.splice(n,0,r),!0;var o=i(e.items[n]);if(o)return o}}var r=$.parseJSON(JSON.stringify(e));delete r.element;var n=i(L.tree);if(n)return d(),n}function O(e,t,i){S=e,R=!0,$(e.element).css("opacity",.3);var r=e.element.data("mode"),n='<div class="ogx_tree_view_drag ogx_tree_view_item ogx_tree_view_'+r+'" style="top:+'+i+"px; left:"+t+'px;"><img src="'+s(e.type)+'"><div class="ogx_tree_view_item_label">'+e.label+"</div></div>";$("body").append(n),$(document).on("mousemove",function(e){e.preventDefault(),$(".ogx_tree_view_drag:first").css("top",e.pageY+"px"),$(".ogx_tree_view_drag:first").css("left",e.pageX+"px")}),$(document).on("mouseup",function(e){e.preventDefault(),X(),b(e.pageX,e.pageY)})}function b(e,t){$(document).off("mousemove"),$(document).off("mouseup"),$(".ogx_tree_view_drag").remove(),$(S.element).css("opacity",1);var r,n=w(e,t);if(n&&(r=h(n)),L.reorder){if(r)if("folder"===r.type)x(S,r);else{var o=y(S,r);o&&i()}}else r&&$(L.container).trigger(OGX.TreeView.DROP,{x:e,y:t,source:S,target:r});S=null,R=!1}function T(){j&&clearInterval(j),D=Date.now(),j=setInterval(G,100)}function G(){if(Date.now()-D>=L.drag_after){var e=v();e&&(O(e.obj,$(e.obj.element).offset().left,$(e.obj.element).offset().top),$(L.container).trigger(OGX.TreeView.DRAG,e),X())}}function X(){j&&(clearInterval(j),j=null)}function V(){for(var e in J)L.hasOwnProperty(e)||(L[e]=J[e])}function C(e){L.toggle&&$(e).hasClass("ogx_tree_view_selected")?($(L.container).trigger(OGX.TreeView.UNSELECT,P),P=null,$(e).removeClass("ogx_tree_view_selected")):($(L.container+" .ogx_tree_view_selected").removeClass("ogx_tree_view_selected"),$(e).addClass("ogx_tree_view_selected"),P=v(),$(L.container).trigger(OGX.TreeView.SELECT,P))}function E(){V(),L.draggable?$(L.container).on("mousedown",".ogx_tree_view_item img",function(e){e.preventDefault(),C(this),T(),$(document).on("mouseup",function(){X()})}):$(L.container).on("click",".ogx_tree_view_item img",function(e){e.preventDefault(),C(this)}),$(L.container).on("dblclick",".ogx_tree_view_item img",function(e){if(e.preventDefault(),X(),$(this).parent(0).children(".ogx_tree_view_container:first").children().length>0&&($(this).parent(0).children(".ogx_tree_view_container:first").toggle(),"folder"===$(this).parent(0).data("mode"))){var t=P.state;"closed"===t?(p($(this).parent(0),!0),P.state="opened",$(L.container).trigger(OGX.TreeView.OPEN,P)):(p($(this).parent(0),!1),P.state="closed",$(L.container).trigger(OGX.TreeView.CLOSE,P))}}),N.el=$(L.container),L.tree&&i()}var S,j,D,P,N=this,L=e,J={show_root:!0,root_label:"root",draggable:!1,reorder:!1,toggle:!0,drag_after:500},R=!1;this.el=null,this.addObject=function(e,t){c(P.obj,e,t)},this.selectObject=function(e){return _(),f(e)},this.deleteSelectedObject=function(){return d()},this.updateSelectedObject=function(e,t){if("type"===e)return!1;var i=v();return!(!i.obj||(i.obj[e]=t,"label"!==e))&&($(".ogx_tree_view_selected:first").next(".ogx_tree_view_item_label").html(t),!0)},this.getTree=function(){var e=r();if(e)return e},this.setTree=function(e){L.tree=e,i()},this.newTree=function(){t()},this.destroy=function(){},E()},OGX.TreeView=function(e){"use strict";return new OGX.prototype.TreeView(e)},OGX.TreeView.SELECT="select",OGX.TreeView.UNSELECT="unselect",OGX.TreeView.OPEN="open",OGX.TreeView.CLOSE="close",OGX.TreeView.DRAG="drag",OGX.TreeView.DROP="drop";